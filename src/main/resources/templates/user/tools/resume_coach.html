<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ë¯¼ê¸° ì¸ë ¥</title>
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<link rel="stylesheet" th:href="@{/user/tools/css/tools_header.css}"/>
<link rel="stylesheet" th:href="@{/user/tools/css/resume_coach.css}"/>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const analyzeBtn = document.querySelector('.analyze-button');
    const resetBtn = document.querySelector('.reset-button');
    const resumeTextarea = document.getElementById('resumeInput');
    const coachingDiv = document.querySelector('.coaching-result');

    // ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ í¬ë§·íŒ…
    function formatText(text) {
        return text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    }

    // ë¡œë”© ìƒíƒœ ì„¤ì •
    function setLoading(isLoading) {
        if (isLoading) {
            // textareaì™€ ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
            resumeTextarea.classList.add('disabled');
            analyzeBtn.classList.add('disabled');
            resetBtn.classList.add('disabled');
            
            // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
            coachingDiv.innerHTML = `
                <div class="loading">
                    ğŸ” AIê°€ ìê¸°ì†Œê°œì„œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤
                    <div class="loading-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
        } else {
            // textareaì™€ ë²„íŠ¼ë“¤ í™œì„±í™”
            resumeTextarea.classList.remove('disabled');
            analyzeBtn.classList.remove('disabled');
            resetBtn.classList.remove('disabled');
        }
    }

    analyzeBtn.addEventListener('click', async function () {
        const resume = resumeTextarea.value.trim();

        if (resume.length < 200) {
            alert("ìê¸°ì†Œê°œì„œëŠ” ìµœì†Œ 200ì ì´ìƒ ì…ë ¥í•´ì•¼ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return;
        }

        setLoading(true);

        try {
            const response = await fetch('/resume/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ content: resume })
            });

            const data = await response.json();

            if (data.choices && data.choices.length > 0) {
                const result = data.choices[0].message.content;
                coachingDiv.innerHTML = formatText(result);
            } else {
                coachingDiv.innerHTML = 'âš ï¸ ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        } catch (err) {
            coachingDiv.innerHTML = 'âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            console.log(err.message);
        } finally {
            setLoading(false);
        }
    });

    resetBtn.addEventListener('click', function () {
        resumeTextarea.value = '';
        coachingDiv.innerHTML = '';
    });
});
</script>

</head>

<body>
<header>
<div th:replace="~{fragments/header :: header}"></div>
</header>

<main>
<div th:replace="~{user/tools/tools_header :: tools-header}"></div>
<div>
<div class="resume-coaching-container">
<div class="resume-input-section">
<label for="resumeInput" class="section-title">ìê¸°ì†Œê°œì„œ</label>
<textarea id="resumeInput" placeholder="ìê¸°ì†Œê°œì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
ì‚¬ëŒì¸ ìì†Œì„œ ê²€ì  AIê°€ ë” ë‹ë³´ì´ëŠ” ìì†Œì„œë¥¼ ì²¨ì‚­í•´ ë“œë ¤ìš”!
ìµœì†Œ 200ì ì´ìƒ ìµœëŒ€ 4000ìê¹Œì§€ ì…ë ¥í•´ì£¼ì…”ì•¼ ì²¨ì‚­ê°€ëŠ¥í•©ë‹ˆë‹¤."></textarea>
</div>
<div class="resume-coaching-section">
<label class="section-title">ì½”ì¹­</label>
<div class="coaching-result"></div>
</div>
</div>

<div class="resume-info">
AIìì†Œì„œ ì½”ì¹­ì€ ì…ë ¥í•˜ì‹  ìê¸°ì†Œê°œì„œì™€ ê·¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œ ë° ë¶„ì„í•˜ë©°, ê´€ë ¨ ì‚¬í•­ì€ 1ë…„ê°„ ë³´ê´€ë©ë‹ˆë‹¤.<br>
(ë‹¤ë§Œ, ì•Œë¦¬ë¯¸ë¥¼ ê±°ì ˆ ë° íšŒì›íƒˆí‡´ ë“±ì„ ìœ„í•´ í•„ìš”í•œ ê²½ìš° ìˆ˜ì§‘í•œ ì •ë³´ëŠ” ê¸°ì—…ì‚¬ì •ì— ë”°ë¼ ê¸°ê°„ ë™ì•ˆ ë³´ê´€ ë° ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)<br>
ë“±ì˜ ë‚´ìš©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì‹  ê²ƒìœ¼ë¡œ ë³´ì•„ AIìì†Œì„œ ì½”ì¹­ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.<br>
AIìì†Œì„œ ì½”ì¹­ ë¶„ì„ì‹œ ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” ê¸°ëª…í™”ë˜ë©°, ì‘ì„±ì ì •ë³´ë¡œ ë¶„ì„í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ AIìì†Œì„œ ì½”ì¹­ ë¶„ì„ ë‚´ì—­ì˜ ëª©ì ì´ë‚˜ ì‚­ì œëŠ” ì¶”ê°€í•˜ë©°, ì½”ì¹­ ë‚´ìš©ì€ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
</div>

<div class="resume-buttons">
<button type="button" class="reset-button">ì´ˆê¸°í™”</button>
<button type="button" class="analyze-button">ë™ì˜ í›„ ë¶„ì„</button>
</div>
</div>
</main>

<footer>
<div th:replace="~{fragments/footer :: footer}"></div>
</footer>
</body>
</html>