<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ë¯¼ê¸° ì¸ë ¥</title>
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<link rel="stylesheet" th:href="@{/user/css/header.css}" />
<link rel="stylesheet" th:href="@{/user/css/footer.css}" />
<link rel="stylesheet" th:href="@{/user/jobPosting/css/main_page.css}"/>
<link rel="stylesheet" th:href="@{/user/jobPosting/css/job_posting.css}"/>
<style type="text/css">
</style>   
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // ê³µí†µ í† ê¸€ í•¨ìˆ˜ ì •ì˜
    function toggleDropdown(button, dropdown, mode = 'block') {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            
            // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ë“¤ ë‹«ê¸°
            const allDropdowns = [
                document.getElementById('techStackDropdown'),
                document.getElementById('historyDropdown'),
                document.getElementById('areaDropdown')
            ];
            
            allDropdowns.forEach(dd => {
                if (dd && dd !== dropdown) {
                    dd.style.display = 'none';
                }
            });
            
            dropdown.style.display = (dropdown.style.display === mode) ? 'none' : mode;
        });

        document.addEventListener('click', function(e) {
            if (!dropdown.contains(e.target) && e.target !== button) {
                dropdown.style.display = 'none';
            }
        });
    }

    // ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const techStackBtn = document.getElementById('techStackBtn');
    const techStackDropdown = document.getElementById('techStackDropdown');
    const historyBtn = document.getElementById('historyBtn');
    const historyDropdown = document.getElementById('historyDropdown');
    const areaBtn = document.getElementById('areaBtn');
    const areaDropdown = document.getElementById('areaDropdown');
    const subRegionPopup = document.getElementById('subRegionPopup');
    const jobItems = document.querySelectorAll('.announcement-card-link');

    // í† ê¸€ í•¨ìˆ˜ ì ìš©
    toggleDropdown(techStackBtn, techStackDropdown);
    toggleDropdown(historyBtn, historyDropdown);
    toggleDropdown(areaBtn, areaDropdown, 'flex');

    // ============== í•„í„°ë§ ìƒíƒœ ê´€ë¦¬ ==============
    let filterState = {
        selectedPositions: ['ì „ì²´'],  // ì„ íƒëœ ì§ë¬´ë“¤
        selectedCareer: 'ì „ì²´',      // ì„ íƒëœ ê²½ë ¥
        selectedRegions: [],         // ì„ íƒëœ ì§€ì—­ë“¤
        selectedTechStacks: []       // ì„ íƒëœ ê¸°ìˆ ìŠ¤íƒë“¤
    };

    // ============== í†µí•© í•„í„°ë§ í•¨ìˆ˜ ==============
    function applyAllFilters() {
        jobItems.forEach(job => {
            const jobCard = job.querySelector('.announcement-card');
            const jobPositionName = job.querySelector('.position-name').textContent.trim();
            const jobCareer = jobCard.dataset.expLevel; // announcement-cardì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const jobAddress = job.querySelector('.company-info span:first-child').textContent.trim();
            const jobTechStacks = job.querySelector('.stack-name').textContent.trim();

            let showJob = true;

            // 1. ì§ë¬´ í•„í„°ë§
            if (!filterState.selectedPositions.includes('ì „ì²´') && filterState.selectedPositions.length > 0) {
                if (!filterState.selectedPositions.includes(jobPositionName)) {
                    showJob = false;
                }
            }

            // 2. ê²½ë ¥ í•„í„°ë§ - ìˆ˜ì •ëœ ë¡œì§
            if (showJob && filterState.selectedCareer !== 'ì „ì²´') {
                if (!checkCareerMatch(jobCareer, filterState.selectedCareer)) {
                    showJob = false;
                }
            }

            // 3. ì§€ì—­ í•„í„°ë§
            if (showJob && filterState.selectedRegions.length > 0) {
                if (!checkRegionMatch(jobAddress, filterState.selectedRegions)) {
                    showJob = false;
                }
            }

            // 4. ê¸°ìˆ ìŠ¤íƒ í•„í„°ë§
            if (showJob && filterState.selectedTechStacks.length > 0) {
                if (!checkTechStackMatch(jobTechStacks, filterState.selectedTechStacks)) {
                    showJob = false;
                }
            }

            // ê²°ê³¼ ì ìš©
            job.style.display = showJob ? 'block' : 'none';
        });
    }

    // ê²½ë ¥ ë§¤ì¹­ í•¨ìˆ˜ - ì™„ì „íˆ ìˆ˜ì •ë¨
    function checkCareerMatch(jobCareer, selectedCareer) {
        console.log('Job Career:', jobCareer, 'Selected Career:', selectedCareer); // ë””ë²„ê¹…ìš©
        
        if (!jobCareer) return false;
        
        // ìˆ«ì ì¶”ì¶œ (ì‹ ì…ì€ 0ìœ¼ë¡œ ì²˜ë¦¬)
        let jobCareerNum = 0;
        if (jobCareer === 'ì‹ ì…') {
            jobCareerNum = 0;
        } else {
            // ìˆ«ì ì¶”ì¶œ (ì˜ˆ: "3ë…„" -> 3, "10ë…„ ì´ìƒ" -> 10)
            const match = jobCareer.match(/\d+/);
            if (match) {
                jobCareerNum = parseInt(match[0]);
            }
        }
        
        // ì„ íƒëœ ê²½ë ¥ê³¼ ë¹„êµ
        switch (selectedCareer) {
            case 'ì‹ ì…':
                return jobCareer === 'ì‹ ì…' || jobCareerNum === 0;
            case '1ë…„':
                return jobCareerNum === 1;
            case '2ë…„':
                return jobCareerNum === 2;
            case '3ë…„':
                return jobCareerNum === 3;
            case '4ë…„':
                return jobCareerNum === 4;
            case '5ë…„':
                return jobCareerNum === 5;
            case '6ë…„':
                return jobCareerNum === 6;
            case '7ë…„':
                return jobCareerNum === 7;
            case '8ë…„':
                return jobCareerNum === 8;
            case '9ë…„':
                return jobCareerNum === 9;
            case '10ë…„ ì´ìƒ':
                return jobCareerNum >= 10;
            default:
                return true;
        }
    }

    // ì§€ì—­ ë§¤ì¹­ í•¨ìˆ˜
    function checkRegionMatch(jobAddress, selectedRegions) {
        return selectedRegions.some(region => {
            if (region.includes('ì „ì²´')) return true;
            return jobAddress.includes(region.replace('ì „ì²´', ''));
        });
    }

    // ê¸°ìˆ ìŠ¤íƒ ë§¤ì¹­ í•¨ìˆ˜
    function checkTechStackMatch(jobTechStacks, selectedTechStacks) {
        return selectedTechStacks.some(stack => 
            jobTechStacks.toLowerCase().includes(stack.toLowerCase())
        );
    }

    // ============== ì§€ì—­ í•„í„°ë§ ==============
 const subRegions = {
    seoul: ['ì„œìš¸ì „ì²´', 'ê°•ë‚¨êµ¬', 'ê°•ë™êµ¬', 'ê°•ë¶êµ¬', 'ê°•ì„œêµ¬', 'ê´€ì•…êµ¬', 'ê´‘ì§„êµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ë…¸ì›êµ¬', 'ë„ë´‰êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ë™ì‘êµ¬', 'ë§ˆí¬êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ì„œì´ˆêµ¬', 'ì„±ë™êµ¬', 'ì„±ë¶êµ¬', 'ì†¡íŒŒêµ¬', 'ì–‘ì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ìš©ì‚°êµ¬', 'ì€í‰êµ¬', 'ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ì¤‘ë‘êµ¬'],
    busan: ['ë¶€ì‚°ì „ì²´', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°'],
    daegu: ['ëŒ€êµ¬ì „ì²´', 'ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°'],
    incheon: ['ì¸ì²œì „ì²´', 'ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°'],
    gwangju: ['ê´‘ì£¼ì „ì²´', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
    daejeon: ['ëŒ€ì „ì „ì²´', 'ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬'],
    ulsan: ['ìš¸ì‚°ì „ì²´', 'ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
    sejong: ['ì„¸ì¢…ì „ì²´', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'],
    gyeonggi: ['ê²½ê¸°ì „ì²´', 'ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬', 'ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬', 'ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬', 'ìˆ˜ì›ì‹œ ì˜í†µêµ¬', 'ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬', 'ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬', 'ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬', 'ì˜ì •ë¶€ì‹œ', 'ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬', 'ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬', 'ë¶€ì²œì‹œ', 'ê´‘ëª…ì‹œ', 'í‰íƒì‹œ', 'ë™ë‘ì²œì‹œ', 'ì•ˆì‚°ì‹œ ìƒë¡êµ¬', 'ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬', 'ê³ ì–‘ì‹œ ë•ì–‘êµ¬', 'ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬', 'ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬', 'ê³¼ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì‹œí¥ì‹œ', 'êµ°í¬ì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ìš©ì¸ì‹œ ì²˜ì¸êµ¬', 'ìš©ì¸ì‹œ ê¸°í¥êµ¬', 'ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬', 'íŒŒì£¼ì‹œ', 'ì´ì²œì‹œ', 'ì•ˆì„±ì‹œ', 'ê¹€í¬ì‹œ', 'í™”ì„±ì‹œ', 'ê´‘ì£¼ì‹œ', 'í¬ì²œì‹œ', 'ì—¬ì£¼ì‹œ', 'ì—°ì²œêµ°', 'ê°€í‰êµ°', 'ì–‘í‰êµ°'],
    gangwon: ['ê°•ì›ì „ì²´', 'ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
    chungbuk: ['ì¶©ë¶ì „ì²´', 'ì²­ì£¼ì‹œ ìƒë‹¹êµ¬', 'ì²­ì£¼ì‹œ í¥ë•êµ¬', 'ì²­ì£¼ì‹œ ì„œì›êµ¬', 'ì²­ì£¼ì‹œ ì²­ì›êµ¬', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
    chungnam: ['ì¶©ë‚¨ì „ì²´', 'ì²œì•ˆì‹œ ë™ë‚¨êµ¬', 'ì²œì•ˆì‹œ ì„œë¶êµ¬', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
    jeonbuk: ['ì „ë¶ì „ì²´', 'ì „ì£¼ì‹œ ì™„ì‚°êµ¬', 'ì „ì£¼ì‹œ ë•ì§„êµ¬', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
    jeonnam: ['ì „ë‚¨ì „ì²´', 'ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
    gyeongbuk: ['ê²½ë¶ì „ì²´', 'í¬í•­ì‹œ ë‚¨êµ¬', 'í¬í•­ì‹œ ë¶êµ¬', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
    gyeongnam: ['ê²½ë‚¨ì „ì²´', 'ì°½ì›ì‹œ ì˜ì°½êµ¬', 'ì°½ì›ì‹œ ì„±ì‚°êµ¬', 'ì°½ì›ì‹œ ë§ˆì‚°í•©í¬êµ¬', 'ì°½ì›ì‹œ ë§ˆì‚°íšŒì›êµ¬', 'ì°½ì›ì‹œ ì§„í•´êµ¬', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
    jeju: ['ì œì£¼ì „ì²´', 'ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
};

// ì§€ì—­ë³„ í´ë¦­ ì´ë²¤íŠ¸ (ì¤‘ë³µ ì œê±°í•˜ê³  í•˜ë‚˜ë¡œ í†µí•©)
document.querySelectorAll('.region-item').forEach(region => {
    region.addEventListener('click', function(e) {
        e.stopPropagation();
        
        // "ì „ì²´" ì˜µì…˜ ì²˜ë¦¬
        if (this.dataset.region === 'all') {
            filterState.selectedRegions = [];
            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
            document.querySelectorAll('#subRegionPopup input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            // ëª¨ë“  ì§€ì—­ ì„ íƒ ìƒíƒœ í•´ì œ
            document.querySelectorAll('.region-item').forEach(item => {
                item.classList.remove('selected');
            });
            updateSelectedTags();
            updateAreaButton();
            // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.getElementById('areaDropdown').style.display = 'none';
            applyAllFilters();
            return;
        }
        // ë‹¤ë¥¸ ì§€ì—­ ì•„ì´í…œë“¤ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
        document.querySelectorAll('.region-item').forEach(item => {
            item.classList.remove('selected');
        });
        this.classList.add('selected');
        
        const regionKey = this.dataset.region;
        const subs = subRegions[regionKey];

        if (subs) {
            // ì„œë¸Œ ì§€ì—­ íŒì—… ìƒì„±
            subRegionPopup.innerHTML = subs.map(sub => 
                `<div class="sub-region-item">
                    <input type="checkbox" id="sub_${sub}" value="${sub}" ${filterState.selectedRegions.includes(sub) ? 'checked' : ''}>
                    <label for="sub_${sub}">${sub}</label>
                 </div>`
            ).join('');
            
            // ì„œë¸Œ ì§€ì—­ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            subRegionPopup.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const value = this.value;
                    
                    if (this.checked) {
                        // "ì „ì²´" ì„ íƒì‹œ í•´ë‹¹ ì§€ì—­ì˜ ë‹¤ë¥¸ ì„ íƒ í•´ì œ
                        if (value.includes('ì „ì²´')) {
                            const regionPrefix = value.replace('ì „ì²´', '');
                            filterState.selectedRegions = filterState.selectedRegions.filter(r => 
                                !r.startsWith(regionPrefix) || r === value
                            );
                            // ê°™ì€ ì§€ì—­ì˜ ë‹¤ë¥¸ ì²´í¬ë°•ìŠ¤ë“¤ í•´ì œ
                            subRegionPopup.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                                if (cb !== this && cb.value.startsWith(regionPrefix)) {
                                    cb.checked = false;
                                }
                            });
                        } else {
                            // ì„¸ë¶€ ì§€ì—­ ì„ íƒì‹œ "ì „ì²´" í•´ì œ
                            const regionName = Object.keys(subRegions).find(key => 
                                subRegions[key].includes(value)
                            );
                            if (regionName) {
                                const regionPrefix = subRegions[regionName][0].replace('ì „ì²´', '');
                                filterState.selectedRegions = filterState.selectedRegions.filter(r => 
                                    r !== regionPrefix + 'ì „ì²´'
                                );
                                const wholeRegionCheckbox = subRegionPopup.querySelector(`input[value="${regionPrefix}ì „ì²´"]`);
                                if (wholeRegionCheckbox) {
                                    wholeRegionCheckbox.checked = false;
                                }
                            }
                        }
                        
                        if (!filterState.selectedRegions.includes(value)) {
                            filterState.selectedRegions.push(value);
                        }
                    } else {
                        const index = filterState.selectedRegions.indexOf(value);
                        if (index > -1) {
                            filterState.selectedRegions.splice(index, 1);
                        }
                    }
                    
                    updateSelectedTags();
                    updateAreaButton();
                    applyAllFilters();
                });
            });
            
            subRegionPopup.style.display = 'block';
        } else {
            subRegionPopup.style.display = 'none';
        }
    });
});

function updateSelectedTags() {
    const selectedTags = document.getElementById('selectedTags');
    selectedTags.innerHTML = '';

    filterState.selectedRegions.forEach(region => {
        const tag = document.createElement('span');
        tag.className = 'region-tag';
        tag.innerHTML = `${region} <button type="button" class="remove-tag" onclick="removeRegionTag('${region}')">Ã—</button>`;
        selectedTags.appendChild(tag);
    });
}

function updateAreaButton() {
    const areaBtn = document.getElementById('areaBtn');
    if (filterState.selectedRegions.length === 0) {
        areaBtn.textContent = 'ì§€ì—­ â–¾';
    } else if (filterState.selectedRegions.length === 1) {
        areaBtn.textContent = filterState.selectedRegions[0] + ' â–¾';
    } else {
        areaBtn.textContent = `${filterState.selectedRegions[0]} ì™¸ ${filterState.selectedRegions.length - 1}ê°œ â–¾`;
    }
}

// ì „ì—­ í•¨ìˆ˜ë¡œ ì •ì˜ (HTMLì—ì„œ onclickìœ¼ë¡œ ì‚¬ìš©)
window.removeRegionTag = function(regionToRemove) {
    const index = filterState.selectedRegions.indexOf(regionToRemove);
    if (index > -1) {
        filterState.selectedRegions.splice(index, 1);
    }

    const checkbox = document.getElementById(`sub_${regionToRemove}`);
    if (checkbox) {
        checkbox.checked = false;
    }

    updateSelectedTags();
    updateAreaButton();
    applyAllFilters();
};

// ì§€ì—­ ì´ˆê¸°í™”
document.getElementById('resetBtn').addEventListener('click', function() {
    filterState.selectedRegions = [];
    document.querySelectorAll('#subRegionPopup input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    document.querySelectorAll('.region-item').forEach(item => {
        item.classList.remove('selected');
    });
    updateSelectedTags();
    updateAreaButton();
    document.getElementById('areaDropdown').style.display = 'none';
    applyAllFilters();
});

// ì§€ì—­ ë§¤ì¹­ í•¨ìˆ˜ - ê°„ë‹¨í•œ ë²„ì „
function checkRegionMatch(jobAddress, selectedRegions) {
    return selectedRegions.some(region => {
        console.log('ë§¤ì¹­ í™•ì¸:', region, 'vs', jobAddress); // ë””ë²„ê¹…ìš©
        
        if (region.includes('ì „ì²´')) {
            // "ì„œìš¸ì „ì²´" â†’ "ì„œìš¸", "ê²½ê¸°ì „ì²´" â†’ "ê²½ê¸°"
            const regionName = region.replace('ì „ì²´', '');
            return jobAddress.includes(regionName);
        } else {
            // ì„¸ë¶€ ì§€ì—­ì€ ì •í™•íˆ ë§¤ì¹­
            return jobAddress.includes(region);
        }
    });
}
    // ============== ê¸°ìˆ ìŠ¤íƒ í•„í„°ë§ ==============
    document.getElementById('techStackSearchInput').addEventListener('keyup', function() {
        let keyword = this.value;

        if (keyword === "") {
            document.getElementById('skillsList').innerHTML = '';
            document.getElementById('skillsList').style.display = 'none';
            return;
        }

        $.ajax({
            url: "/techStack/search",
            type: 'GET',
            data: { keyword: keyword },
            success: function(response) {
                const skillsList = document.getElementById('skillsList');
                skillsList.innerHTML = '';

                if (response.length > 0) {
                    response.forEach(item => {
                        const li = document.createElement('li');
                        li.setAttribute('data-value', item.techStackSeq);
                        li.textContent = item.stackName;
                        skillsList.appendChild(li);
                    });
                    skillsList.style.display = 'block';
                } else {
                    skillsList.style.display = 'none';
                    const noResult = document.createElement('li');
                    noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    skillsList.appendChild(noResult);
                }
            },
            error: function(xhr, status, error) {
                console.error('ì˜¤ë¥˜:', error);
                alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
            }
        });
    });

    // ê¸°ìˆ ìŠ¤íƒ ì„ íƒ
    $('#skillsList').on('click', 'li', function() {
        let text = $(this).text();
        addTechStackTag(text);
        $("#skillsList").hide();
        $("#techStackSearchInput").val('');
    });

    // ì¶”ì²œ ê¸°ìˆ ìŠ¤íƒ í´ë¦­
    $('.recommended-stack').on('click', function() {
        let text = $(this).text();
        addTechStackTag(text);
    });

    function addTechStackTag(stackName) {
        if (!filterState.selectedTechStacks.includes(stackName)) {
            filterState.selectedTechStacks.push(stackName);
            $('#skills').append(
                `<span class="tag">${stackName}
                    <button type="button" class="remove-tag" onclick="removeTechStackTag('${stackName}')">Ã—</button>
                 </span>`
            );
            applyAllFilters();
        }
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ì •ì˜
    window.removeTechStackTag = function(stackName) {
        const index = filterState.selectedTechStacks.indexOf(stackName);
        if (index > -1) {
            filterState.selectedTechStacks.splice(index, 1);
        }
        applyAllFilters();
    };

    // íƒœê·¸ ì œê±° ê¸°ëŠ¥
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-tag')) {
            const tagElement = e.target.parentElement;
            const tagText = tagElement.textContent.replace('Ã—', '').trim();
            
            // ê¸°ìˆ ìŠ¤íƒ íƒœê·¸ ì œê±°
            if (tagElement.classList.contains('tag')) {
                const index = filterState.selectedTechStacks.indexOf(tagText);
                if (index > -1) {
                    filterState.selectedTechStacks.splice(index, 1);
                }
            }
            
            tagElement.remove();
            applyAllFilters();
        }
    });

    // ============== ì§ë¬´ í•„í„°ë§ ==============
    const buttons = document.querySelectorAll('.position-button');
    const maxSelected = 5;

    buttons.forEach(button => {
        button.addEventListener('click', function() {
            const selectedCount = document.querySelectorAll('.position-button.active').length;

            if (button.dataset.position === 'ì „ì²´') {
                buttons.forEach(b => {
                    if (b !== button) {
                        b.classList.remove('active');
                    }
                });
                button.classList.toggle('active');
                filterState.selectedPositions = button.classList.contains('active') ? ['ì „ì²´'] : [];
            } else {
                const totalButton = document.querySelector('.position-button[data-position="ì „ì²´"]');
                if (totalButton.classList.contains('active')) {
                    totalButton.classList.remove('active');
                }

                if (selectedCount >= maxSelected && !button.classList.contains('active')) {
                    alert('ìµœëŒ€ 5ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }

                button.classList.toggle('active');
                
                // ì„ íƒëœ ì§ë¬´ ì—…ë°ì´íŠ¸
                filterState.selectedPositions = Array.from(document.querySelectorAll('.position-button.active'))
                    .map(btn => btn.dataset.position);
            }

            applyAllFilters();
        });
    });

    // ============== ê²½ë ¥ í•„í„°ë§ ==============
    const careerRadios = document.querySelectorAll('input[name="career"]');

    careerRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            filterState.selectedCareer = this.value;
            historyBtn.textContent = this.value + ' â–¾';
            historyDropdown.style.display = 'none';
            applyAllFilters();
        });
    });

    // ê²½ë ¥ ì´ˆê¸°í™”
    const resetCareerBtn = historyDropdown.querySelector('.reset-btn');
    if (resetCareerBtn) {
        resetCareerBtn.addEventListener('click', function() {
            document.getElementById('careerAll').checked = true;
            filterState.selectedCareer = 'ì „ì²´';
            historyBtn.textContent = 'ì „ì²´ â–¾';
            historyDropdown.style.display = 'none';
            applyAllFilters();
        });
    }

    // ============== ì´ˆê¸° ìƒíƒœ ì„¤ì • ==============
    // ì „ì²´ ë²„íŠ¼ ê¸°ë³¸ í™œì„±í™”
    document.querySelector('.position-button[data-position="ì „ì²´"]').classList.add('active');

    
    function resetAllFilters() {
        // 1. ì§ë¬´ í•„í„° ì´ˆê¸°í™”
        document.querySelectorAll('.position-button').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector('.position-button[data-position="ì „ì²´"]').classList.add('active');
        filterState.selectedPositions = ['ì „ì²´'];
        
        // 2. ê¸°ìˆ ìŠ¤íƒ í•„í„° ì´ˆê¸°í™”
        filterState.selectedTechStacks = [];
        document.getElementById('skills').innerHTML = '';
        document.getElementById('techStackSearchInput').value = '';
        document.getElementById('skillsList').style.display = 'none';
        
        // 3. ê²½ë ¥ í•„í„° ì´ˆê¸°í™”
        document.getElementById('careerAll').checked = true;
        filterState.selectedCareer = 'ì „ì²´';
        document.getElementById('historyBtn').textContent = 'ê²½ë ¥ â–¾';
        
        // 4. ì§€ì—­ í•„í„° ì´ˆê¸°í™”
        filterState.selectedRegions = [];
        document.querySelectorAll('#subRegionPopup input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
        document.querySelectorAll('.region-item').forEach(item => {
            item.classList.remove('selected');
        });
        updateSelectedTags();
        updateAreaButton();
        
        // 5. ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.getElementById('techStackDropdown').style.display = 'none';
        document.getElementById('historyDropdown').style.display = 'none';
        document.getElementById('areaDropdown').style.display = 'none';
        
        // 6. í•„í„° ì ìš©í•˜ì—¬ ëª¨ë“  ê³µê³  í‘œì‹œ
        applyAllFilters();
        
        console.log('ëª¨ë“  í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const allResetBtn = document.getElementById('allResetBtn');
        
        if (allResetBtn) {
            allResetBtn.addEventListener('click', function() {
                // í´ë¦­ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                this.classList.add('clicked');
                
                // ì´ˆê¸°í™” ì‹¤í–‰
                resetAllFilters();
                
    
            });
        }
    });
    

</script>
</head>
<body>
<header>
<div th:replace="~{fragments/header :: header}"></div>
</header>
<main>
<div class="main-container">

<div class="stack">
  <span class="position-button" data-position="ì „ì²´">ì „ì²´</span>
  <span class="position-button" data-position="ì„œë²„/ë°±ì—”ë“œ ê°œë°œì">ì„œë²„/ë°±ì—”ë“œ ê°œë°œì</span>
  <span class="position-button" data-position="í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì">í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì</span>
  <span class="position-button" data-position="ì›¹ í’€ìŠ¤íƒ ê°œë°œì">ì›¹ í’€ìŠ¤íƒ ê°œë°œì</span>
  <span class="position-button" data-position="ì•ˆë“œë¡œì´ë“œ ê°œë°œì">ì•ˆë“œë¡œì´ë“œ ê°œë°œì</span>
  <span class="position-button" data-position="iOS ê°œë°œì">iOS ê°œë°œì</span>
  <span class="position-button" data-position="í¬ë¡œìŠ¤í”Œë«í¼ ì•±ê°œë°œì">í¬ë¡œìŠ¤í”Œë«í¼ ì•±ê°œë°œì</span>
  <span class="position-button" data-position="ê²Œì„ í´ë¼ì´ì–¸íŠ¸ ê°œë°œì">ê²Œì„ í´ë¼ì´ì–¸íŠ¸ ê°œë°œì</span>
  <span class="position-button" data-position="ê²Œì„ ì„œë²„ ê°œë°œì">ê²Œì„ ì„œë²„ ê°œë°œì</span>
  <span class="position-button" data-position="DBA">DBA</span>
  <span class="position-button" data-position="ë¹…ë°ì´í„° ì—”ì§€ë‹ˆì–´">ë¹…ë°ì´í„° ì—”ì§€ë‹ˆì–´</span>
  <span class="position-button" data-position="ì¸ê³µì§€ëŠ¥/ë¨¸ì‹ ëŸ¬ë‹">ì¸ê³µì§€ëŠ¥/ë¨¸ì‹ ëŸ¬ë‹</span>
  <span class="position-button" data-position="devops/ì‹œìŠ¤í…œ ì—”ì§€ë‹ˆì–´">devops/ì‹œìŠ¤í…œ ì—”ì§€ë‹ˆì–´</span>
  <span class="position-button" data-position="ì •ë³´ë³´ì•ˆ ë‹´ë‹¹ì">ì •ë³´ë³´ì•ˆ ë‹´ë‹¹ì</span>
  <span class="position-button" data-position="QA ì—”ì§€ë‹ˆì–´">QA ì—”ì§€ë‹ˆì–´</span>
  <span class="position-button" data-position="ê°œë°œ PM">ê°œë°œ PM</span>
  <span class="position-button" data-position="HW/ì„ë² ë””ë“œ">HW/ì„ë² ë””ë“œ</span>
  <span class="position-button" data-position="SW/ì†”ë£¨ì…˜">SW/ì†”ë£¨ì…˜</span>
  <span class="position-button" data-position="ì›¹í¼ë¸”ë¦¬ì…”">ì›¹í¼ë¸”ë¦¬ì…”</span>
  <span class="position-button" data-position="VR/AR/3D">VR/AR/3D</span>
  <span class="position-button" data-position="ë¸”ë¡ì²´ì¸">ë¸”ë¡ì²´ì¸</span>
  <span class="position-button" data-position="ê¸°ìˆ ì§€ì›">ê¸°ìˆ ì§€ì›</span>
</div>


<br><br>

 <!-- ê¸°ìˆ  ìŠ¤íƒ í•„í„° ë°” -->
	<div id="skills" class="skills-container"></div><br>
<div class="filter-container">
  <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ -->
  <button class="filter-btn" id="techStackBtn">ê¸°ìˆ ìŠ¤íƒ â–¾</button>

  <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
  <div class="dropdown" id="techStackDropdown" style="display: none;">
    <!-- ê²€ìƒ‰ ì…ë ¥ì°½ -->
    <input type="text" class="form-control" id="techStackSearchInput" placeholder="ex) javascript">
    <ul class="custom-options" id="skillsList">
	  <li th:each="techStack : ${techStackList}">
	    <span th:text="${techStack.stackName}"></span> <!-- ê¸°ìˆ  ìŠ¤íƒ ì´ë¦„ í‘œì‹œ -->
	  </li>
	</ul>
    <br>
    
    <h2 style="font-size: 13px;">ì¶”ì²œê¸°ìˆ ìŠ¤íƒ</h2>
   <div id="recommendedTechStacks">
    <span class="recommended-stack">Java</span>
    <span class="recommended-stack">Python</span>
    <span class="recommended-stack">JavaScript</span>
    <span class="recommended-stack">C++</span>
</div>
  </div>
</div>
  <!-- -------------------------ê²½ë ¥-------------------------------- -->
  
 <div class="filter-container">
  <button class="filter-btn" id="historyBtn">ê²½ë ¥ â–¾</button>
  <div class="dropdown" id="historyDropdown" style="display: none;">
    <div class="radio-group">
      <div class="radio-item">
        <input type="radio" id="careerAll" name="career" value="ì „ì²´" checked>
        <label for="careerAll">ì „ì²´</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="careerNew" name="career" value="ì‹ ì…">
        <label for="careerNew">ì‹ ì…</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career1" name="career" value="1ë…„">
        <label for="career1">1ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career2" name="career" value="2ë…„">
        <label for="career2">2ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career3" name="career" value="3ë…„">
        <label for="career3">3ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career4" name="career" value="4ë…„">
        <label for="career4">4ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career5" name="career" value="5ë…„">
        <label for="career5">5ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career6" name="career" value="6ë…„">
        <label for="career6">6ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career7" name="career" value="7ë…„">
        <label for="career7">7ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career8" name="career" value="8ë…„">
        <label for="career8">8ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career9" name="career" value="9ë…„">
        <label for="career9">9ë…„</label>
      </div>
      <div class="radio-item">
        <input type="radio" id="career10" name="career" value="10ë…„ ì´ìƒ">
        <label for="career10">10ë…„ ì´ìƒ</label>
      </div>
    </div>
    <div class="reset-btn">ì´ˆê¸°í™”</div>
  </div>
</div>
  <!-- -------------------------ì§€ì—­-------------------------------- -->
  <div class="filter-container">
    <button class="filter-btn" id="areaBtn">ì§€ì—­ â–¾</button>

    <div class="dropdown hidden" id="areaDropdown">
        <div class="area-dropdown">
            <div class="area-content">
                <div class="region-wrapper">
                    <div class="region-item" data-region="all">ì „ì²´</div>
                    <div class="region-item" data-region="seoul">ì„œìš¸</div>
                    <div class="region-item" data-region="gyeonggi">ê²½ê¸°</div>
                    <div class="region-item" data-region="incheon">ì¸ì²œ</div>
                    <div class="region-item" data-region="busan">ë¶€ì‚°</div>
                    <div class="region-item" data-region="daegu">ëŒ€êµ¬</div>
                    <div class="region-item" data-region="gwangju">ê´‘ì£¼</div>
                    <div class="region-item" data-region="daejeon">ëŒ€ì „</div>
                    <div class="region-item" data-region="ulsan">ìš¸ì‚°</div>
                    <div class="region-item" data-region="gangwon">ê°•ì›</div>
                    <div class="region-item" data-region="chungbuk">ì¶©ë¶</div>
                    <div class="region-item" data-region="chungnam">ì¶©ë‚¨</div>
                    <div class="region-item" data-region="jeonbuk">ì „ë¶</div>
                    <div class="region-item" data-region="jeonnam">ì „ë‚¨</div>
                    <div class="region-item" data-region="gyeongbuk">ê²½ë¶</div>
                    <div class="region-item" data-region="gyeongnam">ê²½ë‚¨</div>
                    <div class="region-item" data-region="jeju">ì œì£¼</div>
                </div>

                <div class="sub-region-popup" id="subRegionPopup">
                    <!-- í•˜ìœ„ ì§€ì—­ ì²´í¬ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <div class="selected-tags" id="selectedTags">
                <!-- ì„ íƒëœ íƒœê·¸ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <button class="region-reset" id="resetBtn">ì´ˆê¸°í™”</button>
        </div>
    </div>
</div>
 <button class="all-reset-button" id="allResetBtn">
    <span class="reset-icon">ğŸ”„</span>
    ì „ì²´ ì´ˆê¸°í™”
  </button>
<br><br>


<!--  ê³µê³ ( ì¸ê¸°ìˆœ ) -->
<div class="announcement-section">
    <div class="announcement-list">
        <a th:if="${jobPostingList != null and jobPostingList.size() > 0}"
           th:each="job : ${jobPostingList}"
           th:href="@{/user/job_posting/job_posting_detail(jobPostingSeq=${job.jobPostingSeq})}"
           class="announcement-card-link">
            <div class="announcement-card" th:attr="data-position-seq=${job.positionSeq}, data-exp-level=${job.expLevel}">
                
                <div class="image-wrapper">
                    <!-- ê¸°ì—… ì´ë¯¸ì§€ -->
                    <img th:src="@{/images/corpimg/{img}(img=${job.corpImg})}" alt="ê¸°ì—… ì´ë¯¸ì§€">
                </div>   
             <div class="dday-badge" 
			     th:classappend="${job.daysRemaining != null and job.daysRemaining == 0} ? 'dday' : 
			                    (${job.daysRemaining != null and job.daysRemaining < 0} ? 'expired' : 
			                    (${job.daysRemaining != null and job.daysRemaining <= 3 and job.daysRemaining > 0} ? 'urgent' : 'normal'))">
			<span th:text="${job.ddayDisplay}">D-day</span>
			</div>
                <!-- ê¸°ì—… ì´ë¦„ -->
                <div class="company-name" th:text="${job.corpNm}">íšŒì‚¬ëª…</div>
                
                <!-- ê³µê³  ì œëª© -->
                <div class="announcement-title">
                    <strong th:text="${job.postingTitle}">ê³µê³  ì œëª©</strong>
                </div>
                
                <!-- ê¸°ìˆ  ìŠ¤íƒ ì¶œë ¥ -->
                <div class="stack-name">
                  <span th:text="${job != null} ? ${job.techNames} : ''"></span>
                </div>
                
                <div class="company-info">
                    <!-- ì§€ì—­ (ì£¼ì†Œì˜ ì²« 7ì) -->
                    <span th:text="|${job.region} ${job.district}|">ì§€ì—­</span> |
                    <!-- ê²½ë ¥ ì—¬ë¶€ (ì‹ ì…/ê²½ë ¥) -->
                    <span th:text="${job.expLevel}">ê²½ë ¥</span>
                </div>
                
                
                <div class="position-name" th:text="${job.positionName}">ì§ë¬´</div>
            </div>
        </a>
        
        <div th:if="${jobPostingList == null or jobPostingList.size() == 0}">
            <p>ë“±ë¡ëœ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
</div>

</div>
</main>
<footer>
<div th:replace="~{fragments/footer :: footer}"></div>
</footer>
</body>
</html>