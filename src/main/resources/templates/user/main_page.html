<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ë¯¼ê¸° ì¸ë ¥</title>
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<link rel="stylesheet" th:href="@{/user/css/header.css}" />
<link rel="stylesheet" th:href="@{/user/css/footer.css}" />
<link rel="stylesheet" th:href="@{/user/jobPosting/css/main_page.css}"/>
<style type="text/css">
</style>   
<script type="text/javascript">
let current = 0;
const total = 4; 

function moveSlide(direction) {    
    current += direction; 
    if (current >= total) current = 0;
    if (current < 0) current = total - 1;
    updateSlide();
}

function updateSlide() {
    const track = document.querySelector('.header-carousel-track');
    if (track) {  // ìš”ì†Œ ì¡´ì¬ í™•ì¸ ì¶”ê°€
        track.style.transform = `translateX(-${current * 100}%)`;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë§Œ ì—¬ê¸°ì— ë“±ë¡
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    if (prevBtn) {
        prevBtn.addEventListener('click', function() {
            moveSlide(-1);
        });
    }
    
    if (nextBtn) {
        nextBtn.addEventListener('click', function() {
            moveSlide(1);
        });
    }
    
    // ìë™ ìŠ¬ë¼ì´ë“œë„ DOMì´ ë¡œë“œëœ í›„ì— ì‹œì‘
    setInterval(() => moveSlide(1), 5000);
});

// ì•Œë¦¼ ê¸°ëŠ¥
let isDropdownOpen = false;
let unreadCount = 3;

function toggleNotifications() {
    const dropdown = document.getElementById('notificationDropdown');
    
    if (!dropdown) return; // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ì•Œë¦¼ ê¸°ëŠ¥ ì—†ìŒ
    
    isDropdownOpen = !isDropdownOpen;
    
    if (isDropdownOpen) {
        dropdown.classList.add('show');
    } else {
        dropdown.classList.remove('show');
    }
}

function markAsRead(element) {
    if (element.classList.contains('unread')) {
        element.classList.remove('unread');
        unreadCount--;
        updateNotificationBadge();
    }
}

function updateNotificationBadge() {
    const badge = document.getElementById('notificationBadge');
    if (!badge) return; // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë°°ì§€ ì—†ìŒ
    
    if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.style.display = 'flex';
    } else {
        badge.style.display = 'none';
    }
}

function clearAllNotifications() {
    const items = document.querySelectorAll('.notification-item');
    items.forEach(item => {
        if (item.classList.contains('unread')) {
            item.classList.remove('unread');
        }
    });
    unreadCount = 0;
    updateNotificationBadge();
    
    // ì•Œë¦¼ ëª©ë¡ ë¹„ìš°ê¸°
    setTimeout(() => {
        const dropdown = document.getElementById('notificationDropdown');
        if (dropdown) {
            dropdown.innerHTML = '<div class="notification-empty">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }, 300);
}

// ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸° - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ
document.addEventListener('click', function(event) {
    const notificationArea = document.querySelector('.notification-area');
    if (notificationArea && !notificationArea.contains(event.target) && isDropdownOpen) {
        toggleNotifications();
    }
});

// ìƒˆ ì•Œë¦¼ ì¶”ê°€ í•¨ìˆ˜ - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ
function addNewNotification(message, time, icon = 'ğŸ“¢') {
    const dropdown = document.getElementById('notificationDropdown');
    if (!dropdown) return; // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ì•Œë¦¼ ì¶”ê°€ ë¶ˆê°€
    
    const footer = dropdown.querySelector('.notification-footer');
    
    const newItem = document.createElement('div');
    newItem.className = 'notification-item unread';
    newItem.onclick = function() { markAsRead(this); };
    newItem.innerHTML = `
        <div class="notification-content">
            <div class="notification-icon-small">${icon}</div>
            <div class="notification-text">
                <div class="notification-message">${message}</div>
            </div>
        </div>
    `;
    
    dropdown.insertBefore(newItem, footer);
    unreadCount++;
    updateNotificationBadge();
}

//ê²€ìƒ‰ê¸°ëŠ¥
$(document).ready(function(){
	
	const $input= $("#keywordInput");
	const $box=$("#autocomplete-box");
	
	$input.on("keyup", function(){
		
		const term =$(this).val();
		if(term.length <1){
			$box.hide().empty();
			return;
		}
		
		$.ajax({
			
			url:"/autocomplete",
			method:"GET",
			data:{term:term},
			success:function(data){
				$box.empty();
				if(data.length==0){
					$box.hide();
					return;
				}//end if
				
				data.forEach(function (item){
					
					const $item= $("<div>")
					 			.css({padding:"8px", cursor:"pointer"})
					 			.append($("<span>")
					 			.text(item))
					 			.on("click", function(){
					 				$input.val(item);
					 				$box.empty().hide();
					 			});
						$box.append($item);
				});
				
				
				$box.show();
			}
			
			
		});//ajax
		
		
	});
	
	$(document).on("click", function(e){
		if(!$(e.target).closest("#autocomplete-box", "keywordInput").length){
			$box.hide();
		}
			
	})
	
	
});//ready


</script>
</head>
<body>
<header>
<div th:replace="~{fragments/header :: header}"></div>
</header>
<main>
<div class="main-container">
    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <section class="hero-section">
        <h1 class="hero-title">ê°œë°œì ì»¤ë¦¬ì–´ì˜ ì‹œì‘</h1>
        <p class="hero-subtitle">ì „êµ­ ìµœê³ ì˜ IT ê¸°ì—…ë“¤ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤</p>

        <div class="hero-search">
        	<form th:action="@{/search}" method="get" style="position: relative;">
            <input type="text" name="keyword" id="keywordInput" class="hero-search-box"
                   placeholder="ì–´ë–¤ í¬ì§€ì…˜ì„ ì°¾ê³  ê³„ì‹ ê°€ìš”?"/>
            <div class="autocomplete-dropdown" id="autocomplete-box"  style="position: absolute; top: 100%; left: 0; right: 0; border: 1px solid #ccc;
                background-color: white; display: none; z-index: 999;"></div>
            <button type="submit" id="searchButton" class="hero-search-button">ğŸ”</button>
        	</form>
        </div>

        <!-- ì„ íƒí•œ í‚¤ì›Œë“œ í‘œì‹œ -->
        <div id="selectedKeywords" class="selected-keywords"></div>
        
</section>
    
    <!-- ì˜¤ë¥¸ìª½ í—¤ë”ë¶€ë¶„ : ì±„ìš©ê³µê³  + ê³µì§€ -->
    <div class="side-by-side-section">
      <div class="header-section">
        <!-- Carousel Container -->
        <div class="header-carousel-container">
          <div class="header-carousel-track">
            <!-- íƒ€ì„ë¦¬í”„ë¥¼ ì´ìš©í•˜ì—¬ ëœë¤ ê³µê³  ì¶œë ¥ -->
          <th:block th:if="${randomPostings != null and randomPostings.size() > 0}">
		    <th:block th:each="randomPosting : ${randomPostings}">
		        <div class="main-img">
		            <a th:href="@{/user/job_posting/job_posting_detail(jobPostingSeq=${randomPosting.jobPostingSeq})}"
		               class="main-img-link">
		                <img th:src="@{/images/corpimg/{img}(img=${randomPosting.corpImg})}" alt="ê¸°ì—… ì´ë¯¸ì§€"/> 
		                <div class="main-content">
		                    <h2 th:text="${randomPosting.corpNm}">íšŒì‚¬ ì´ë¦„</h2>
		                    <p th:text="${randomPosting.postingTitle != null ? randomPosting.postingTitle : 'ì œëª© ì—†ìŒ'}">ê³µê³  ì œëª©</p>
		                </div>
		            </a>
		        </div>
		    </th:block>
		</th:block>
		<th:block th:unless="${randomPostings != null and randomPostings.size() > 0}">
		    <div class="main-img">
		        <img src="/images/default_img.jpg" />
		        <div class="main-content">
		            <h2>í˜„ì¬ ëœë¤ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</h2>
		            <p>ìƒˆë¡œìš´ ê³µê³ ë¥¼ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
		        </div>
		    </div>
		</th:block>
	          </div>
          <button class="header-carousel-btn prev" id="prevBtn">â€¹</button>
          <button class="header-carousel-btn next" id="nextBtn">â€º</button>
        </div>
      </div>

      <div class="notice-wrapper">
        <!-- ì‚¬ìš©ì ì •ë³´ ë°•ìŠ¤ (ê¶Œí•œë³„ë¡œ ë‹¤ë¥¸ ë‚´ìš© í‘œì‹œ) -->
        <div class="user-info-section">
          <!-- ê¸°ì—…íšŒì› -->
          <div sec:authorize="hasRole('ROLE_CORP')">
           <div class="user-info-box">
              <div class="access-denied-container">
                  <h2 style="font-size: 17px;">ê¸°ì—…íšŒì›ì€ ê°œì¸íšŒì› ë©”ë‰´ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>
                  <a th:href="@{/corp/main}" class="redirect-btn">ê¸°ì—…íšŒì› ë©”ì¸</a>
              </div>
              </div>
          </div>
          
          <!-- ë¹„íšŒì› -->
          <div sec:authorize="!hasRole('ROLE_USER') and !hasRole('ROLE_CORP')">
           <div class="user-info-box">
              <div class="login-required">
                  <h2 style="font-size: 17px;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
                  <a th:href="@{/login}" class="login-btn">ë¡œê·¸ì¸</a>
                  <a th:href="@{/user/join}" class="signup-btn">íšŒì›ê°€ì…</a>
              </div>
              </div>
          </div>
          
          <!--ì‚¬ìš©ì  -->
          <div sec:authorize="hasRole('ROLE_USER')">
          <div class="user-info-box">
              <div th:if="${user != null and user.corpNo == null}">
                  <p class="user-welcome" th:text="${user.name}">ì‚¬ìš©ì</p>
                  <p class="user-email" th:text="${user.email}">ì´ë©”ì¼ ì—†ìŒ</p>
                  <div class="user-menu-buttons">
                      <a th:href="@{/user/resume/resume_management}" class="user-menu-btn resume-btn">ì´ë ¥ì„œì‘ì„±</a>
                      <a th:href="@{/user/mypage}" class="user-menu-btn mypage-btn">ë§ˆì´í˜ì´ì§€</a>
                  </div>
              </div>
          </div>
          </div>
        </div>
        <br>
        <!-- ê³µì§€ì‚¬í•­ ì„¹ì…˜ (ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ) -->
          <div class="notice-section">
          <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="color: #1DD45A;">Notice</h2>
            <a th:href="@{/user/job_posting/notice_list}" style="font-size: 13px; color: gray; text-decoration: none;">ë”ë³´ê¸°</a>
            </div>
          <div class="notice-info">
            <!-- ê³µì§€ì‚¬í•­ì´ ì—†ì„ ë•Œ -->
            <div th:if="${noticeList == null}">
              <p style="color: #666; font-size: 12px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <!-- ê³µì§€ì‚¬í•­ì´ ìˆì„ ë•Œ -->
            <div th:each="notice : ${noticeList}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 3px 0;">
             <a th:href="@{/notice/detail/{seq}(seq=${notice.noticeSeq})}"
           style="max-width: 60%;
                  white-space: nowrap;
                  overflow: hidden;
                  text-overflow: ellipsis;
                  font-size: 13px;
                  cursor: pointer;
                  text-decoration: none;
                  color: black;"
           th:text="${notice.title}"></a>
  			<div style="font-size: 12px; color: gray; margin-left: 5px;" th:text="${notice.regsDate}"></div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ì¸ê¸°ìˆœ ê³µê³  ì„¹ì…˜ -->
    <div class="announcement-section">
    <h3>ì¸ê¸°ìˆœ</h3>
    <div class="announcement-list">
        <th:block th:if="${popularPostings != null and popularPostings.size() > 0}">
            <th:block th:each="posting : ${popularPostings}">
                <div class="announcement-card">
                    <a th:href="@{/user/job_posting/job_posting_detail(jobPostingSeq=${posting.jobPostingSeq})}"
                       class="announcement-card-link">
                        <div class="image-wrapper">
                             <img th:src="@{/images/corpimg/{img}(img=${posting.corpImg})}" alt="ê¸°ì—… ì´ë¯¸ì§€">
                        </div>
                        <div class="company-name" th:text="${posting.corpNm}">íšŒì‚¬ ì´ë¦„</div>
                        <div class="announcement-title">
                            <strong th:text="${posting.postingTitle}">ê³µê³  ì œëª©</strong>
                        </div>
                        
                         <div class="stack-name">
		                  <span th:text="${posting != null} ? ${posting.techNames} : ''"></span>
		                </div>
                        <div class="company-info">
                            <span  th:text="|${posting.region} ${posting.district}|">ìœ„ì¹˜</span> |
                            <span th:text="${posting.expLevel}">ê²½ë ¥</span>
                        </div>
                    </a>
                </div>
            </th:block>
        </th:block>
        <th:block th:unless="${popularPostings != null and popularPostings.size() > 0}">
            <div class="no-postings">
                <p>í˜„ì¬ ì¸ê¸° ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </th:block>
    </div>
</div>
</div>
</main>
<footer>
  <div th:replace="~{fragments/footer :: footer}"></div>
</footer>
</body>
</html>