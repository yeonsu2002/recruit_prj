<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ë¯¼ê¸°ì¸ë ¥ - ê¸°ì—… ë©”ì¸</title>
<!-- ì¹´ì¹´ì˜¤ì§€ë„ -->
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link rel="stylesheet" th:href="@{/corp/mainCss/main_page.css}"/>
<link rel="stylesheet" th:href="@{/corp/jobPosting/jobPostingForm.css}">
<style>

</style>
<script type="text/javascript">
//headerì—ì„œ corpNoê°–ê³ ì™€ì„œ ì „ì—­ë³€ìˆ˜í™”, ì•„ë‹ˆë©´ jsì—ì„œ ëœ¯ì–´ë„ ë˜ê³  
var corpNo = "";

document.addEventListener('DOMContentLoaded', () => {
	const userInfo = `[[${user}]]`;
	console.log(userInfo);
	
	//thymeleaf ë¬¸ë²•ìœ¼ë¡œ ê°–ê³ ì™€ë³´ê¸° 
	corpNo = `[[${user.corpNo}]]`;
	
	// ì¹´ì¹´ì˜¤ë§µ ì£¼ì†Œ ì°¾ê¸°
	document.getElementById("openKakaoMap").addEventListener("click", openKakaoMap);
	
	// í¬ì§€ì…˜ ë¹„ë™ê¸° ê²€ìƒ‰ ì¡°íšŒ
	getPositionList();
	
	// ê¸°ìˆ ìŠ¤íƒ ë¹„ë™ê¸° ê²€ìƒ‰ ì¡°íšŒ
	getStackList();
	
	// í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
	setupFormSubmission();
	
	// ì§„í–‰ë¥  í‘œì‹œ ê¸°ëŠ¥ ì´ˆê¸°í™”
	initProgressTracking();
	
	// ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ :ë¯¸êµ¬í˜„ 
	//initPreviewFeature();
	
	// ê³µê³  ì‹œì‘ì¼ì„ í˜„ì¬ ë‚ ì§œë¡œ ì„¤ì •
	setPostingStartDate();
	
	//ê¸‰ì—¬ ì…ë ¥ ìë™ ì±„ìš°ê¸° 
	initSalaryFormatting();
	
	//ê³„ì•½ì§ ì´ì™¸ ì„ íƒì‹œ ê³„ì•½ê¸°ê°„ íƒ­ ë¹„í™œì„±í™”
	preventContDt();
	
	//ê³µê³  ë§ˆê°ì¼ í˜„ì¬ë‚ ì§œë³´ë‹¤ ì•ìœ¼ë¡œ ëª»ê°€ê²Œ ê°ì‹œ 
	document.querySelector('input[name="postingEndDt"]').addEventListener('change', setPostingEndDate);

	//ê³„ì•½ ë‚ ì§œ ê²€ì¦
	document.querySelectorAll('.contractDt').forEach(input => {
		input.addEventListener('change', isValidStdEdd);
	});
	
});//end ready

/**
 * ì¹´ì¹´ì˜¤ ì£¼ì†Œì°¾ê¸° API í˜¸ì¶œ
 */
function openKakaoMap(){
	new daum.Postcode({
	    oncomplete: function(data) {
	    	console.log('ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼:', data);
	    	document.getElementById("region").value = data.sido; // ì‹œë„ 
	    	document.getElementById("district").value = data.sigungu; // ì‹œêµ°êµ¬ 
	    	document.getElementById("zipcode").value = data.zonecode; // ìš°í¸ë²ˆí˜¸ 
	    	document.getElementById("roadAddress").value = data.roadAddress; // ë„ë¡œëª…ì£¼ì†Œ 
	    }
	}).open();
}

/**
 * í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ ë¹„ë™ê¸° ê²€ìƒ‰ ê¸°ëŠ¥
 */
function getPositionList() {
	const positionInput = document.getElementById('positionName');
	const resultBox = document.getElementById('resultBox');
	
	function noResultBox(){
		document.querySelector('#resultBox').style.display = 'none';
	}
	function showResultBox(){
		document.querySelector('#resultBox').style.display = 'block';
	}
	
	//ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ
	positionInput.addEventListener('keyup', function () {
		let keyword = this.value.trim();
		if (keyword === '') {
			resultBox.style.display = 'none';
			return;
		}
		searchFetch(keyword);
	});

	//inputí´ë¦­í•˜ë©´ ê²°ê³¼ì°½ í˜¸ì¶œ
	positionInput.addEventListener('click', function () {
		if (this.value.trim() !== '') {
			showResultBox();
		}
	});

	//ë°”ê¹¥ í´ë¦­ì‹œ ê²°ê³¼ì°½ ë‹«ìŒ , ë‹¨ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¨¼ì € ì‹¤í–‰ë˜ë„ë¡ ì‚´ì§ ì§€ì—°
	positionInput.addEventListener('focusout', function () {
		setTimeout(() => {
			resultBox.style.display = 'none';
		}, 150); 
	});

	// ë§ˆìš°ìŠ¤ê°€ resultBox ë²„íŠ¼ëˆ„ë¥´ë©´ focusout ë¬´ì‹œ---------------------- ì´ê±° ì—„ì²­ ì¤‘ìš” ì´ê²Œ í¬ì¸íŠ¸ 
	resultBox.addEventListener('mousedown', function (e) {
		e.preventDefault(); // input focus ì•„ì˜ˆ ì•ˆ ë¹ ì§€ê²Œ ë§‰ìŒ
	});
	
	// 1ê¸€ì ì´ìƒì¼ ë•Œ ê²€ìƒ‰ ì‹œì‘
	function searchFetch(keyword){
		let resultBox = document.querySelector('#resultBox');
		
		if (keyword.length >= 1) {
			fetch(`/corp/searchPositionByKeyword?keyword=${encodeURIComponent(keyword)}`)
				.then(response => {
					if (!response.ok) {
						throw new Error("í¬ì§€ì…˜ ë¦¬ìŠ¤íŠ¸ í˜¸ì¶œ ì¤‘ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
					}
					return response.json();
				})
				.then(data => {
					if (data.length > 0) {
						resultBox.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™” 
						resultBox.style.display = 'block';

						// ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ
						data.forEach(item => {
							const li = document.createElement('li');
							li.textContent = item.positionName;
							li.classList.add('position-li');
							li.setAttribute('data-position-seq', item.positionSeq);

							// í¬ì§€ì…˜ ì„ íƒ ì‹œ ì´ë²¤íŠ¸
							li.addEventListener('click', function () {
								document.getElementById('positionName').value = item.positionName;
								document.getElementById('positionSeq').value = item.positionSeq;
								console.log(item.positionName);
								resultBox.style.display = 'none';
								console.log('ìŠ¤íƒ€ì¼ ë‹«í˜ ì•ˆë³´ì—¬ì•¼í•´ ')
							});

							resultBox.appendChild(li);
						});
					} else {
						// ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
						document.getElementById('positionSeq').value = '';
						resultBox.innerHTML = '<li>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</li>';
						resultBox.style.display = 'block';
					}
				})
				.catch(error => {
					console.error("í¬ì§€ì…˜ ê²€ìƒ‰ ì—ëŸ¬:", error);
					resultBox.innerHTML = '<li>ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li>';
					resultBox.style.display = 'block';
				});
		}
	} //searchFetch()
}

/**
 * ê¸°ìˆ ìŠ¤íƒ ê²€ìƒ‰ ë° ì¶”ê°€ ê¸°ëŠ¥
 */
function getStackList() {
	const techStackList = document.querySelector("#techStack-list");
	const suggestedList = document.querySelector("#suggestedStackList");

	/**
	 * ê¸°ìˆ ìŠ¤íƒ ì¶”ê°€ í•¨ìˆ˜
	 */
	function addTechStack(stackName, stackSeq) {
		// ì¤‘ë³µ ë°©ì§€ ì²´í¬
		const isDuplicate = [...document.querySelectorAll('input[name="techStack"]')]
			.some(input => input.value.toLowerCase() === stackName.toLowerCase());

		if (isDuplicate) {
			alert(`${stackName}ëŠ” ì´ë¯¸ ë“±ë¡í•˜ì…¨ìŠµë‹ˆë‹¤.`);
			return;
		}

		// ìµœëŒ€ 5ê°œ ì œí•œ
		if (document.querySelectorAll('input[name="techStack"]').length >= 5) {
			alert('ê¸°ìˆ ìŠ¤íƒì€ ìµœëŒ€ 5ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
			return;
		}

		// ìŠ¤íƒ ë±ƒì§€ ìƒì„±
		const badge = document.createElement("span");
		badge.className = "badge bg-primary tech-tag me-1";
		badge.innerHTML = `${stackName} <button type="button" class="btn-close btn-close-white btn-sm ms-2" aria-label="Close"></button>`;

		// ìŠ¤íƒ ì´ë¦„ì„ ìœ„í•œ hidden input
		const hiddenInput = document.createElement("input");
		hiddenInput.type = "hidden";
		hiddenInput.name = "techStack";
		hiddenInput.value = stackName;
		badge.appendChild(hiddenInput);

		// ìŠ¤íƒ ì‹œí€€ìŠ¤ë¥¼ ìœ„í•œ hidden input
		const hiddenSeqInput = document.createElement("input");
		hiddenSeqInput.type = "hidden";
		hiddenSeqInput.name = "techStackSeqList";
		hiddenSeqInput.value = stackSeq;
		hiddenSeqInput.id = `input-${stackName}`;
		badge.appendChild(hiddenSeqInput);

		// ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
		badge.querySelector("button").addEventListener("click", (e) => {
			e.preventDefault();
			techStackList.removeChild(badge);
		});

		techStackList.appendChild(badge);
	}
	
	//suggestedStackList ì•ˆë³´ì´ê²Œ í•¨ìˆ˜
	function noSuggestedStackList(){
		document.querySelector('#suggestedStackList').style.display = 'none';
	}
	//suggestedStackList ë³´ì´ê²Œ í•¨ìˆ˜
	function showSuggestedStackList(){
		document.querySelector('#suggestedStackList').style.display = 'block';
	}

	// ê¸°ìˆ ìŠ¤íƒ ê²€ìƒ‰ ìë™ì™„ì„±
	document.querySelector("#techStackSearch").addEventListener("input", function () {
		const keyword = this.value.trim();
		suggestedList.innerHTML = "";
		
		if(keyword.length >= 0){
			showSuggestedStackList();
		}

		if (keyword.length === 0){
			noSuggestedStackList();
			return;
		}
		
		document.querySelector("#techStackSearch").addEventListener('focusout', function(){
			noSuggestedStackList();
		});
		document.querySelector("#techStackSearch").addEventListener('click', function(){
			showSuggestedStackList();
		});
		
		// ë§ˆìš°ìŠ¤ê°€ suggestedStackList ë²„íŠ¼ëˆ„ë¥´ë©´ focusout ë¬´ì‹œ
		suggestedList.addEventListener('mousedown', function (e) {
			e.preventDefault(); // input focus ì•„ì˜ˆ ì•ˆ ë¹ ì§€ê²Œ ë§‰ìŒ
		});
		

		// ê¸°ìˆ ìŠ¤íƒ ê²€ìƒ‰ API í˜¸ì¶œ
		fetch(`/corp/searchStackByKeyword?keyword=${encodeURIComponent(keyword)}`)
			.then(response => {
				if (!response.ok) {
					throw new Error("ê¸°ìˆ ìŠ¤íƒ í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
				}
				return response.json();
			})
			.then(data => {
				suggestedList.innerHTML = "";
				

				// ê²€ìƒ‰ì–´ì— ë§ëŠ” ë°ì´í„° í•„í„°ë§
				const filteredData = data.filter(item =>
					item.stackName.toLowerCase().includes(keyword.toLowerCase())
				);

				if (filteredData.length > 0) {
					// ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìƒì„±
					filteredData.forEach(item => {
						const li = document.createElement('li');
						li.textContent = item.stackName;
						li.classList.add('stack-li');
						li.setAttribute('data-stack-seq', item.techStackSeq);

						// ìŠ¤íƒ ì„ íƒ ì‹œ ì´ë²¤íŠ¸
						li.addEventListener('click', function () {
							addTechStack(item.stackName, item.techStackSeq);
							suggestedList.innerHTML = "";
							document.querySelector("#techStackSearch").value = "";
							suggestedList.style.display = 'none';
						});
						suggestedList.style.display = 'block';

						suggestedList.appendChild(li);
					});
				} else {
					suggestedList.innerHTML = '<li>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</li>';
					suggestedList.style.display = 'block';
				}
			})
			.catch(error => {
				console.error("ê¸°ìˆ ìŠ¤íƒ ê²€ìƒ‰ ì—ëŸ¬:", error);
				suggestedList.innerHTML = '<li>ê¸°ìˆ  ìŠ¤íƒ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li>';
				suggestedList.style.display = 'block';
			});
	});
	
}

/**
 * í¼ ì œì¶œ ì´ë²¤íŠ¸ ì„¤ì •
 */
function setupFormSubmission() {
	document.getElementById('submitFormBtn').addEventListener('click', function(e) {
		e.preventDefault();
		
		// ê³„ì•½ì§ì¸ ê²½ìš° ê³„ì•½ ê¸°ê°„ í•„ìˆ˜ ì²´í¬
		const employType = document.querySelector('[name="employType"]').value;
		if(employType === "ê³„ì•½"){
			document.getElementById('contStartDt').setAttribute('required', 'required');
			document.getElementById('contEndDt').setAttribute('required', 'required');
		} else {
			document.getElementById('contStartDt').removeAttribute('required');
			document.getElementById('contEndDt').removeAttribute('required');
		}
		
		// í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
		if (!validateRequiredFields()) {
			return;
		}
		
		// í¼ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
		submitJobPostingForm();
	});
}

/**
 * í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
 */
function validateRequiredFields() {
	const requiredFields = document.querySelectorAll('[required]');
	let isValid = true;
	
	requiredFields.forEach(field => {
		if (!field.value.trim()) {
			field.style.borderColor = '#e74c3c';
			isValid = false;
		} else {
			field.style.borderColor = '#e1e8ed';
		}
	});
	
	if (!isValid) {
		alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		return false;
	}
	
	return true;
}

/**
 * ì±„ìš©ê³µê³  í¼ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì„œë²„ì— ì „ì†¡
 */
function submitJobPostingForm() {
	try {
		// í¼ ë°ì´í„° ìˆ˜ì§‘
		const formData = collectFormData();
		console.log(formData);
		
		// JSON í˜•íƒœë¡œ ì„œë²„ì— ì „ì†¡
		fetch('/corp/updateJobPosting', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json', //ë‚´ê°€ ë³´ë‚´ëŠ” ìš”ì²­ì˜ í˜•ì‹ (ì˜ˆ: JSONì„ ë³´ë‚´ëŠ” ì¤‘)
				'Accept': 'application/json' //ë‚´ê°€ ë°›ê³  ì‹¶ì€ ì‘ë‹µ í˜•ì‹ (ì˜ˆ: JSON ë°›ê³  ì‹¶ìŒ)
				//ì‚¬ìš©ë°©ë²•ì€ ë‚˜ì¤‘ì— ë” ì•Œì•„ë´ 
			},
			body: JSON.stringify(formData)
		})
		.then(response => {
			if (!response.ok) {
				throw new Error(`HTTP error! status: ${response.status}`);
			}
			return response.text(); // ì„œë²„ì—ì„œ ë¬¸ìì—´ ì‘ë‹µì„ ë°›ìŒ
		})
		.then(data => {
			console.log('ê³µê³  ìˆ˜ì • ì„±ê³µ:', data);
			alert('ì±„ìš©ê³µê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
			// ì„±ê³µ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” í˜ì´ì§€ ì´ë™
			location.href = "/corp/main";
		})
		.catch(error => {
			console.error('ê³µê³  ìˆ˜ì • ì—ëŸ¬:', error);
			alert('ê³µê³  ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
		});
		
	} catch (error) {
		console.error('í¼ ë°ì´í„° ì²˜ë¦¬ ì—ëŸ¬:', error);
		alert('í¼ ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
	}
}

/**
 * í¼ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ê°ì²´ë¡œ ë°˜í™˜
 */
function collectFormData() {
	// ê¸°ë³¸ í¼ ë°ì´í„° ìˆ˜ì§‘
	const formData = {
		jobPostingSeq : document.getElementById('jobPostingSeq').value,
		postingTitle: document.getElementById('postingTitle').value,
		positionSeq: document.getElementById('positionSeq').value,
		expLevel: document.getElementById('expLevel').value,
		eduLevel: document.getElementById('eduLevel').value,
		employType: document.getElementById('employType').value,
		recruitCnt: parseInt(document.getElementById('recruitCnt').value),
		salary: document.getElementById('salary').value ? parseInt(document.getElementById('salary').value.replace(/,/g, '')) : 0,
		workday: document.getElementById('workday').value,
		workStartTime: document.getElementById('workStartTime').value,
		workEndTime: document.getElementById('workEndTime').value,
		contStartDt: document.getElementById('contStartDt').value,
		contEndDt: document.getElementById('contEndDt').value,
		zipcode: document.getElementById('zipcode').value,
		roadAddress: document.getElementById('roadAddress').value,
		detailAddress: document.getElementById('detailAddress').value,
		region: document.getElementById('region').value,
		district: document.getElementById('district').value,
		postingDetail: document.getElementById('postingDetail').value,
		postingStartDt: document.getElementById('postingStartDt').value,
		postingEndDt: document.getElementById('postingEndDt').value,
		corpNo: getUserCorpNo() // ì‚¬ìš©ìì˜ íšŒì‚¬ ë²ˆí˜¸ (ì„¸ì…˜ ë˜ëŠ” ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ê°€ì ¸ì™€ì•¼ í•¨)
	};
	
	// ê¸°ìˆ ìŠ¤íƒ ë°°ì—´ ìˆ˜ì§‘
	const techStackInputs = document.querySelectorAll('input[name="techStack"]');
	const techStackSeqInputs = document.querySelectorAll('input[name="techStackSeqList"]');
	
	formData.techStack = Array.from(techStackInputs).map(input => input.value);
	formData.techStackSeqList = Array.from(techStackSeqInputs).map(input => parseInt(input.value));
	
	console.log('ìˆ˜ì§‘ëœ í¼ ë°ì´í„°:', formData);
	return formData;
}

/**
 * ì‚¬ìš©ìì˜ íšŒì‚¬ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
 * @returns {number} íšŒì‚¬ ë²ˆí˜¸
 */
function getUserCorpNo() {
	// ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„¸ì…˜, ë¡œì»¬ìŠ¤í† ë¦¬ì§€, ë˜ëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ì‚¬ìš©
	// ì˜ˆì‹œë¡œ í•˜ë“œì½”ë”©ëœ ê°’ ì‚¬ìš© (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê°’ì„ ì‚¬ìš©í•´ì•¼ í•¨)
	const corpNo = `[[${user.corpNo}]]`; // Thymeleaf ë³€ìˆ˜
	// userInfoì—ì„œ corpNo ì¶”ì¶œí•˜ëŠ” ë¡œì§ í•„ìš”
	return corpNo; 
}

/**
 * ì§„í–‰ë¥  í‘œì‹œ ê¸°ëŠ¥ ì´ˆê¸°í™”
 */
function initProgressTracking() {
	const inputs = document.querySelectorAll('.form-input, .form-textarea, .form-select');
	const progressFill = document.querySelector('.progress-fill');
	const progressText = document.querySelector('.progress-text');
	
	/**
	 * ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
	 */
	function updateProgress() {
		const requiredFields = document.querySelectorAll('[required]');
		const filledFields = Array.from(requiredFields).filter(input => {
			if (input.type === 'checkbox' || input.type === 'radio') {
				return input.checked;
			}
			return input.value.trim() !== '';
		}).length;
		
		const progress = Math.round((filledFields / requiredFields.length) * 100);
		
		progressFill.style.width = progress + '%';
		progressText.textContent = progress + '% ì™„ë£Œ';
		
		// í”„ë¡œê·¸ë ˆìŠ¤ ë°” ìƒ‰ìƒ ë³€ê²½
		if (progress < 30) {
			progressFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
		} else if (progress < 70) {
			progressFill.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
		} else {
			progressFill.style.background = 'linear-gradient(90deg, #667eea, #764ba2)';
		}
	}
	
	// ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
	inputs.forEach(input => {
		input.addEventListener('input', updateProgress);
		input.addEventListener('change', updateProgress);
	});
	
	// ì´ˆê¸° ì§„í–‰ë¥  ì„¤ì •
	updateProgress();
}

/**
 * ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ì´ˆê¸°í™”
 */
/* function initPreviewFeature() {
	document.querySelector('.preview-btn').addEventListener('click', function() {
		const formData = collectFormData();
		
		alert('ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì„ ì¤€ë¹„ì¤‘.. \n\nì…ë ¥ëœ ë°ì´í„°ëŠ” ì½˜ì†”ì—ì„œ í™•ì¸..');
	});
} */

/**
 * ê³µê³  ì‹œì‘ì¼ì„ í˜„ì¬ ë‚ ì§œë¡œ ì„¤ì •
 */
function setPostingStartDate() {
	const today = new Date();
	const formattedDate = today.toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
	document.getElementById('postingStartDt').value = formattedDate;
}

/**
 * ê³µê³  ë§ˆê°ì¼ í˜„ì¬ë‚ ì§œë³´ë‹¤ ì•ìœ¼ë¡œ ëª»ê°€ê²Œ ê°ì‹œ 
 */
 function setPostingEndDate(){
	const today = new Date();
	let dt = document.querySelector('input[name="postingEndDt"]').value;
	//ë‚ ì§œë¡œ ë³€í™˜
	const endDt =  new Date(dt);
	if(endDt < today.setHours(0,0,0,0)){
		alert('ê³µê³  ë§ˆê°ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ì´ì „ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ');
		document.querySelector('input[name="postingEndDt"]').value = "";
	}
}
/**
 * ì—°ë´‰ ì…ë ¥ ì‹œ ë‹¨ìœ„ í‘œì‹œ ê¸°ëŠ¥
 */
function initSalaryFormatting() {
	const salaryInput = document.querySelector('input[name="salary"]');
	if (salaryInput) {
		salaryInput.addEventListener('input', function() {
			let value = this.value;
			value = value.replace(/[^0-9]/g, ''); //ìˆ«ì ì´ì™¸ì˜ ë¬¸ì ì œê±°
			this.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		});
	}
}

/**
 * ê³„ì•½ì§ ì´ì™¸ ì„ íƒì‹œ, ê³„ì•½ê¸°ê°„ íƒ­ ë¹„í™œì„±í™” 
 */
 function preventContDt(){
	document.querySelector('select[name="employType"]').addEventListener('change', function(){
		let type = this.value;
		if(type == "ê³„ì•½"){
			document.querySelector('input[name="contStartDt"]').disabled = false;
			document.querySelector('input[name="contEndDt"]').disabled = false;
		} else {
			document.querySelector('input[name="contStartDt"]').disabled = true;
			document.querySelector('input[name="contEndDt"]').disabled = true;
			document.querySelector('input[name="contStartDt"]').value = "";
			document.querySelector('input[name="contEndDt"]').value = "";
		}
	})
}

/**
 * ê³„ì•½ê¸°ê°„ ë‚ ì§œ ì‹¤ì‹œê°„ ê²€ì¦ 
 */
 function isValidStdEdd(){
	const today = new Date();
	const startDayStr = document.querySelector('input[name="contStartDt"]').value;
	const endDayStr = document.querySelector('input[name="contEndDt"]').value;

	//ë‚ ì§œë¡œ ë³€í™˜
	const startDay = new Date(startDayStr);
	const endDay = new Date(endDayStr);
	
	//1. ì‹œì‘ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ì „ìœ¼ë¡œ í• ìˆ˜ ì—†ë‹¤.
	if(startDay < today.setHours(0,0,0,0,)){
		alert("ê³„ì•½ ì‹œì‘ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ì´ì „ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		document.querySelector('input[name="contStartDt"]').value = "";
		return;
	}
	//2. ë§ˆê°ì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì•ì¼ ìˆ˜ ì—†ë‹¤. 
	if(endDay < startDay.setHours(0,0,0,0)){
		alert("ê³„ì•½ ë§ˆê°ì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ");
		document.querySelector('input[name="contEndDt"]').value = "";
		return;
	}
}
 
 
 

</script>

</head>
<body>
<th:block th:replace="~{fragments/corpHeader :: corpHeader}"></th:block>

<div class="job-posting-container">
    <div class="job-posting-header">
        <h1 class="job-posting-title">ì±„ìš©ê³µê³  ìˆ˜ì •</h1>
        <p class="job-posting-subtitle">ìš°ìˆ˜í•œ ì¸ì¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ì •í™•í•˜ê³  ìƒì„¸í•œ ì •ë³´ë¡œ ë” ë§ì€ ì§€ì›ìë¥¼ ë§Œë‚˜ë³´ì„¸ìš”.</p>
    </div>
    <div class="job-posting-main">
        <div class="job-posting-form">
            <form id="frm" th:action="@{/corp/uplaodJobPosting}" method="post" enctype="application/x-www-form-urlencoded">
                
                <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                <div class="job-posting-section">
                    <h2 class="section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h2>
                    
                    <div class="form-group">
                    	<input type="hidden" id="jobPostingSeq" name="jobPostingSeq" th:value="${posting.jobPostingSeq}">
                        <label class="form-label required">ê³µê³  ì œëª©</label>
                        <input type="text" id="postingTitle" name="postingTitle" class="form-input" placeholder="ì˜ˆ: [ì‹ ì…/ê²½ë ¥] ë°±ì—”ë“œ ê°œë°œì ëª¨ì§‘" th:value="${posting.postingTitle}" required>
                        <div class="form-help">ì§€ì›ìë“¤ì´ ê°€ì¥ ë¨¼ì € ë³´ê²Œ ë˜ëŠ” ì œëª©ì…ë‹ˆë‹¤. ëª…í™•í•˜ê³  ë§¤ë ¥ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.</div>
                    </div>

                    <div class="form-group position-box">
                        <label class="form-label required">í¬ì§€ì…˜</label>
                        <input type="text" id="positionName" name="positionSeq" class="form-input" placeholder="í¬ì§€ì…˜ ê²€ìƒ‰" style="position: relative;"  autocomplete="off">
                        <ul id="resultBox" class="list-group position-absolute" style="display: none" ></ul>
                        <input type="hidden" id="positionSeq"> <!-- hiddenìœ¼ë¡œ -->
                    </div>
                    
                    <div class="form-group techStack-box">
                        <label class="form-label">ì£¼ìš” ê¸°ìˆ ìŠ¤íƒ <span style="color: red">*</span> </label>
                        <input type="text" id="techStackSearch" name="techStackSearch" class="form-input" placeholder="ì˜ˆ: Java, Spring Boot, MySQL, AWS">
                        <!-- ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ (ë¹„ë™ê¸°ë¡œ ul > li) -->
												<ul id="suggestedStackList" class="list-group mt-1 position-absolute" style="z-index:1000; display: none;"></ul>
												<!-- ì„ íƒëœ ìŠ¤íƒë“¤ -->
												<div id="techStack-list" class="mt-3"></div>
												<!-- ìŠ¤íƒ seqë‹´ì„ input -->
												<div id="hiddenInputsArea"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">ê²½ë ¥ ìš”êµ¬ì‚¬í•­</label>
                        <select name="expLevel" id="expLevel" class="form-select"  required>
                            <option value="none" selected readonly>ê²½ë ¥ ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì „ì²´">ì „ì²´ (ì‹ ì…/ê²½ë ¥ ë¬´ê´€)</option>
                            <option value="ì‹ ì…">ì‹ ì… (ê²½ë ¥ ì—†ìŒ)</option>
                            <option value="1ë…„">1ë…„ ì´ìƒ</option>
                            <option value="2ë…„">2ë…„ ì´ìƒ</option>
                            <option value="3ë…„">3ë…„ ì´ìƒ</option>
                            <option value="4ë…„">4ë…„ ì´ìƒ</option>
                            <option value="5ë…„">5ë…„ ì´ìƒ</option>
                            <option value="6ë…„">6ë…„ ì´ìƒ</option>
                            <option value="7ë…„">7ë…„ ì´ìƒ</option>
                            <option value="8ë…„">8ë…„ ì´ìƒ</option>
                            <option value="9ë…„">9ë…„ ì´ìƒ</option>
                            <option value="10ë…„">10ë…„ ì´ìƒ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">í•™ë ¥ ì¡°ê±´</label>
                        <select name="eduLevel" id="eduLevel" class="form-select"  required>
                            <option value="">í•™ë ¥ ì¡°ê±´ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë¬´ê´€">í•™ë ¥ ë¬´ê´€</option>
                            <option value="ê³ ì¡¸ì´ìƒ">ê³ ë“±í•™êµ ì¡¸ì—… ì´ìƒ</option>
                            <option value="ì´ˆëŒ€ì¡¸">ì „ë¬¸ëŒ€í•™ ì¡¸ì—… ì´ìƒ</option>
                            <option value="ëŒ€ì¡¸">ëŒ€í•™êµ ì¡¸ì—… ì´ìƒ</option>
                            <option value="ì„ì‚¬">ì„ì‚¬ ì´ìƒ</option>
                            <option value="ë°•ì‚¬">ë°•ì‚¬ ì´ìƒ</option>
                        </select>
                    </div>
                </div>

                <!-- ê·¼ë¬´ ì¡°ê±´ ì„¹ì…˜ -->
                <div class="job-posting-section">
                    <h2 class="section-title">ğŸ’¼ ê·¼ë¬´ ì¡°ê±´</h2>
                    
                    <div class="form-group">
                        <label class="form-label required">ê³ ìš© í˜•íƒœ</label>
                        <select name="employType" id="employType" class="form-select" required>
                            <option value="">ê³ ìš© í˜•íƒœë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì •ê·œ">ì •ê·œì§</option>
                            <option value="ê³„ì•½">ê³„ì•½ì§</option>
                            <option value="ì¸í„´">ì¸í„´</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">ëª¨ì§‘ ì¸ì›</label>
                        <input type="number" id="recruitCnt" name="recruitCnt" class="form-input" placeholder="ëª¨ì§‘ ì¸ì› ìˆ˜" min="1" th:value="${posting.recruitCnt}" required>
                        <div class="form-help">ì±„ìš© ì˜ˆì • ì¸ì› ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ê¸‰ì—¬</label>
                        <input type="text" id="salary" name="salary" class="form-input" placeholder="ì—°ë´‰ì„ ì…ë ¥í•˜ì„¸ìš” (ë‹¨ìœ„: ì›)" th:value="${posting.salary}" >
                        <div class="salary-info">
                            <span>íšŒì‚¬ë‚´ê·œë¥¼ ì›í•˜ì‹¤ ê²½ìš° 0ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ê·¼ë¬´ ìš”ì¼</label>
                        <input type="text" id="workday" name="workday" class="form-input" placeholder="ì˜ˆ: ì›”~ê¸ˆ, ì£¼ 5ì¼" th:value="${posting.workday}">
                        <div class="form-help">ê·¼ë¬´í•˜ëŠ” ìš”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ê·¼ë¬´ ì‹œê°„</label>
                        <div class="time-range">
                            <input type="time" id="workStartTime" name="workStartTime" class="form-input" th:value="${posting.workStartTime}">
                            <span>~</span>
                            <input type="time" id="workEndTime" name="workEndTime" class="form-input" th:value="${posting.workEndTime}">
                        </div>
                        <div class="form-help">ê·¼ë¬´ ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ê³„ì•½ ê¸°ê°„ (ê³„ì•½ì§ì¸ ê²½ìš°)</label>
                        <div class="date-range">
                            <input type="date" id="contStartDt" name="contStartDt" class="form-input contractDt">
                            <span>~</span>
                            <input type="date" id="contEndDt" name="contEndDt" class="form-input contractDt">
                        </div>
                        <div class="form-help">ê³„ì•½ì§ì¸ ê²½ìš°ì—ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                    </div>
                </div>

                <!-- ê·¼ë¬´ì§€ ì •ë³´ ì„¹ì…˜ -->
                <div class="job-posting-section">
                    <h2 class="section-title">ğŸ“ ê·¼ë¬´ì§€ ì •ë³´</h2>
                    
                    <div class="form-group">
                        <label class="form-label required">ê·¼ë¬´ì§€ ì£¼ì†Œ</label>
                        <div class="zipcode-box">
                            <input type="text" id="zipcode" name="zipcode" class="form-input" placeholder="ìš°í¸ë²ˆí˜¸" th:value="${posting.zipcode}" readonly>
                            <button type="button" id="openKakaoMap" class="btn btn-secondary">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button>
                        </div>
                        <input type="text" id="roadAddress" name="roadAddress" class="form-input" placeholder="ë„ë¡œëª… ì£¼ì†Œ" th:value="${posting.roadAddress}" readonly style="margin-bottom: 10px;">
                        <input type="text" id="detailAddress" name="detailAddress" class="form-input" placeholder="ìƒì„¸ ì£¼ì†Œ (ê±´ë¬¼ëª…, ì¸µìˆ˜ ë“±)" th:value="${posting.detailAddress}">
                        <div class="form-help">ì •í™•í•œ ê·¼ë¬´ì§€ ì •ë³´ëŠ” ì§€ì›ìë“¤ì˜ ì§€ì› ê²°ì •ì— ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤.</div>
                        <input type="hidden" id="region" name="region" th:value="${posting.region}">
                        <input type="hidden" id="district" name="district" th:value="${posting.district}">
                    </div>
                </div>

                <!-- ìƒì„¸ ì •ë³´ ì„¹ì…˜ -->
                <div class="job-posting-section">
                    <h2 class="section-title">ğŸ“ ìƒì„¸ ì •ë³´</h2>
                    
                    <div class="form-help important">
                        <strong>âœ¨ ì‘ì„± ê°€ì´ë“œ</strong><br>
                        â€¢ ì£¼ìš” ì—…ë¬´ì™€ ì±…ì„ì„ êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•´ì£¼ì„¸ìš”<br>
                        â€¢ í•„ìš”í•œ ê¸°ìˆ ê³¼ ê²½í—˜ì„ ëª…í™•íˆ ì‘ì„±í•´ì£¼ì„¸ìš”<br>
                        â€¢ íšŒì‚¬ ë¬¸í™”ì™€ ë³µì§€ í˜œíƒì„ ìƒì„¸íˆ ì†Œê°œí•´ì£¼ì„¸ìš”<br>
                        â€¢ ì„±ì¥ ê¸°íšŒì™€ êµìœ¡ ì§€ì›ì— ëŒ€í•´ ì–¸ê¸‰í•´ì£¼ì„¸ìš”
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">ì±„ìš©ê³µê³  ìƒì„¸ ë‚´ìš©</label>
                        <textarea name="postingDetail" id="postingDetail" class="form-textarea" rows="12" wrap="on"
												placeholder="ğŸ“Œ ì£¼ìš” ì—…ë¬´&#10;- ë‹´ë‹¹í•˜ê²Œ ë  êµ¬ì²´ì ì¸ ì—…ë¬´ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”&#10;- í”„ë¡œì íŠ¸ ì„±ê²©, ì‚¬ìš© ê¸°ìˆ , í˜‘ì—… ë°©ì‹ ë“±ì„ í¬í•¨í•´ì£¼ì„¸ìš”&#10;&#10;ğŸ¯ ìê²© ìš”ê±´&#10;- í•„ìˆ˜ ìš”êµ¬ì‚¬í•­ì„ ëª…í™•íˆ ì‘ì„±í•´ì£¼ì„¸ìš”&#10;- ìš°ëŒ€ì‚¬í•­ë„ í•¨ê»˜ ì‘ì„±í•˜ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤&#10;&#10;ğŸ ë³µì§€ ë° í˜œíƒ&#10;- ê¸‰ì—¬ ì™¸ ë³µë¦¬í›„ìƒì„ ìƒì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”&#10;- êµìœ¡ ì§€ì›, ê·¼ë¬´ í™˜ê²½, ì„±ì¥ ê¸°íšŒ ë“±ì„ í¬í•¨í•´ì£¼ì„¸ìš”&#10;&#10;ğŸ“‹ ì±„ìš© ì ˆì°¨&#10;- ì„œë¥˜ ì „í˜•ë¶€í„° ìµœì¢… ë©´ì ‘ê¹Œì§€ì˜ ê³¼ì •ì„ ì•ˆë‚´í•´ì£¼ì„¸ìš”"
												th:text="${posting.postingDetail}"
												required></textarea>
                    </div>

                    <div class="form-group">
                    	<input type="hidden" id="postingStartDt" name="postingStartDt" value="";>
                        <label class="form-label required">ê³µê³  ë§ˆê°ì¼</label>
                        <div class="date-range">
                            <div style="flex: 1;">
                                <input type="date" id="postingEndDt" name="postingEndDt" class="form-input" th:value="${posting.postingEndDt}" required>
                            </div>
                        </div>
                        <div class="form-help">ê³µê³ ê°€ ê²Œì‹œë  ê¸°ê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
                    </div>
                </div>
            </form>
        </div>

        <div class="job-posting-sidebar">
            <div class="sidebar-card">
                <h3 class="sidebar-title">ğŸš€ ê³µê³  ìˆ˜ì •</h3>
                
                <div class="progress-indicator">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0% ì™„ë£Œ</div>
                </div>

                <button type="button" form="frm" id="submitFormBtn"  class="submit-btn">ì±„ìš©ê³µê³  ìˆ˜ì •í•˜ê¸°</button>
                
                <div class="preview-section">
<!--                     <button type="button" class="preview-btn">ë¯¸ë¦¬ë³´ê¸°</button>
 -->                </div>
            </div>

            <div class="sidebar-card tips-section">
                <h4 class="tips-title">ğŸ’¡ ì‘ì„± íŒ</h4>
                <ul class="tips-list">
                    <li>êµ¬ì²´ì ì´ê³  ëª…í™•í•œ ì—…ë¬´ ë‚´ìš© ì‘ì„±</li>
                    <li>í•„ìš”í•œ ê¸°ìˆ ìŠ¤íƒê³¼ ê²½í—˜ ëª…ì‹œ</li>
                    <li>íšŒì‚¬ ë¬¸í™”ì™€ ë³µì§€ í˜œíƒ ìƒì„¸ ê¸°ì¬</li>
                    <li>ì„±ì¥ ê¸°íšŒì™€ êµìœ¡ ì§€ì› ë‚´ìš© í¬í•¨</li>
                    <li>íˆ¬ëª…í•œ ì±„ìš© ì ˆì°¨ ì•ˆë‚´</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{fragments/corpFooter :: corpFooter}"></th:block>
</body>
</html>