<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ì¼ë°˜íšŒì› ê°€ì… í˜ì´ì§€</title>
<th:block th:replace="~{fragments/external_file :: cdn_block}"></th:block>
<link rel="stylesheet" th:href="@{/login/joinUserForm.css}">
<style>
    
</style>
<!-- ì¹´ì¹´ì˜¤ì§€ë„ -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript">
$(function(){
	
	isForYou();
	
	//ë¹„ë°€ë²ˆí˜¸ ê·œì •ì— ë§ëŠ”ì§€ í™•ì¸ì—¬ë¶€UI
	isRightPassword();
	
	//ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë™ì¼ ì—¬ë¶€
	chkPasswordOneNTwo();
	
	//ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ ajax
	ckEmailDupl();
	
	//ì¹´ì¹´ì˜¤ë§µ ì£¼ì†Œ ì°¾ê¸°
	document.getElementById("openKakaoMap").addEventListener("click", openKakaoMap);
	
	//ëª¨ë‹¬ ê³¨ë¼ ë³´ê¸° í˜¸ì¶œ
	showTheModal(); 
	
	// ì „ì²´ ë™ì˜ ì²´í¬ë°•ìŠ¤ ê¸°ëŠ¥
	document.getElementById('terms1').addEventListener('change', function() {
	    const checkboxes = document.querySelectorAll('.checkbox-input:not(#terms1)');
	    checkboxes.forEach(checkbox => {
	        checkbox.checked = this.checked;
	    });
	});
	
	// ê°œë³„ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì „ì²´ ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
	document.querySelectorAll('.checkbox-input:not(#terms1)').forEach(checkbox => {
	    checkbox.addEventListener('change', function() {
	        const allCheckboxes = document.querySelectorAll('.checkbox-input:not(#terms1)');
	        const checkedBoxes = document.querySelectorAll('.checkbox-input:not(#terms1):checked');
	        document.getElementById('terms1').checked = allCheckboxes.length === checkedBoxes.length;
	    });
	});
	
	// í¼ ì œì¶œ ì²˜ë¦¬
	document.querySelector('form').addEventListener('submit', function(e) {
	    e.preventDefault();
	    //ì˜ˆì™¸ì²˜ë¦¬ ê²€ì‚¬ í•¨ìˆ˜ í˜¸ì¶œ
	    if(validateForm()){
		    alert('íšŒì›ê°€ì… ì–‘ì‹ì´ ì •ìƒì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
		    this.submit();
	    } else {
	    	console.log('ë­”ê°€ê°€ ì˜ëª»ë˜ì—ˆì–´..');
	    }
	    
	});
	
	//í¼ ì˜ˆì™¸ì²˜ë¦¬ ê²€ì‚¬
	function validateForm(){
		
		let isEverythingOk = true;
		
		// ì´ë©”ì¼ í˜•ì‹ ì •ê·œí‘œí˜„ì‹
		const email = document.getElementById('email').value.trim();
		const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
		if (!emailPattern.test(email)) {
	  	alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: user@example.com)");
	  	isEverythingOk = false;
	  	return false;
		}
		//ì´ë©”ì¼ì¸ì¦ ì•ˆë°›ì•˜ì„ ì‹œ 
		if(!isEmailVerified){
			alert("ì´ë©”ì¼ ì¸ì¦ì„ ì§„í–‰í•´ì£¼ì„¸ìš”");
			document.getElementById("email").focus();
			isEverythingOk = false;
			return false;
		}
		
		//ë¹„ë°€ë²ˆí˜¸
		const password = document.getElementById("password").value.trim();
		const password2 = document.getElementById("password2").value.trim();
	  	const pwPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s#$*])[\S]{8,}$/;
    	if (!pwPattern.test(password)) {
	      alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸ ëŒ€ë¬¸ì, ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì(ê³µë°±, $#*ì œì™¸)ë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
	      isEverythingOk = false;
	      return false;
	    }
	    if(password != password2){
	    	alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
	    	document.getElementById('password2').focus();
	    	isEverythingOk = false;
	      return false;
	    }
			
		//íœ´ëŒ€í°
		const phone = document.getElementById("phone").value;
	   	const phonePattern = /^010-\d{4}-\d{4}$/;
	    if (!phonePattern.test(phone)) {
	      alert("í•¸ë“œí° ë²ˆí˜¸ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	      isEverythingOk = false;
	      return false;
	  	}
		
		//ì´ë¦„
    	const name = document.getElementById('name').value.trim();
		const namePattern = /^[ê°€-í£a-zA-Z]{2,20}$/;
		if (!namePattern.test(name)) {
	  	alert("ì´ë¦„ì€ 2~20ìì˜ í•œê¸€ ë˜ëŠ” ì˜ë¬¸ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
	  	isEverythingOk = false;
	 	 	return false;
		}
		
		//ìƒë…„ì›”ì¼
		const birth = document.getElementById("birth").value.trim();
		//const birthPattern = /^(19[0-9]{2}|20[0-9]{2})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])$/;
		const birthPattern = /^(19\d{2}|20\d{2})-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/;
		if(!birthPattern.test(birth)){
			alert("ì˜³ë°”ë¥¸ ìƒë…„ì›”ì¼ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
			isEverythingOk = false;
			return false;
		}
		
		//ì„±ë³„
		/* 	document.querySelectorAll('.form-check-input')ë¡œ ì„±ë³„ ë¼ë””ì˜¤ ë²„íŠ¼ë“¤ì„ ê°€ì ¸ì˜´.
				some()ì„ ì‚¬ìš©í•´ì„œ í•˜ë‚˜ë¼ë„ ì²´í¬ëœ í•­ëª©ì´ ìˆëŠ”ì§€ í™•ì¸. */
		const isGenderChecked = Array.from(document.querySelectorAll('.form-check-input')).some(checkbox => checkbox.checked);
		if(!isGenderChecked){ //í•˜ë‚˜ë„ ì²´í¬ëœê²Œ ì—†ë‹¤ë©´~
			alert("ì„±ë³„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
			isEverythingOk = false;
			return false;
		}
		
		//ì£¼ì†Œ
		/* 	.some() â†’ í•˜ë‚˜ë¼ë„ ì±„ì›Œì ¸ ìˆìœ¼ë©´ true â†’ ì´ê±´ ì „ì²´ ì±„ì›€ ì²´í¬ì— ë¶€ì ì ˆ
				.every() â†’ ëª¨ë‘ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ true â†’ í•˜ë‚˜ë¼ë„ ë¹„ë©´ false â†’ ì´ê²Œ ì ì ˆ! */
		const isAddrfilled = Array.from(document.querySelectorAll('.form-input.addr')).every(input => input.value);
		if(!isAddrfilled){
			alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
			isEverythingOk = false;
			return false;
		}
		
		
		//ì•½ê´€ - í•„ìˆ˜ í•­ëª© ì²´í¬ ì—¬ë¶€ í™•ì¸
		let termFlag = true;
		document.querySelectorAll('.checkbox-input.required').forEach(checkbox => {
			if(!checkbox.checked){
				termFlag = false;
			}
		});
		
		if(!termFlag){
			alert('í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
			isEverythingOk = false;
			return false;		
		}
		
		
		console.log(isEverythingOk);
		return isEverythingOk;
		
	}//validateForm()
	
	
	//ì¸ì¦ë²ˆí˜¸ ì²˜ë¦¬, ì¸ì¦ìš”ì²­ ë²„íŠ¼ì„ í´ë¦­ì‹œ (5ë¶„ í•˜ì)
	document.getElementById('codeBtn').addEventListener('click', function(){
		
		// ì´ë©”ì¼ í˜•ì‹ ì •ê·œí‘œí˜„ì‹
		const email = document.getElementById('email').value.trim();
		const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
		if (!emailPattern.test(email)) {
	  		alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: user@example.com)");
	  		return false;
		}
		
		if(email == ""){
			alert('ì´ë©”ì¼ì„ ì…ë ¥ í›„ ì¸ì¦ìš”ì²­ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
			return false;
		}
		
		fetch('/signup/send-verification-email', {
				method : "POST",
				headers : {
					"Content-Type": "application/json"
				},
				body : JSON.stringify({
					emailAddr : email,
					subject : "ë¯¼ê¸°ì¸ë ¥ íšŒì›ê°€ì… ì´ë©”ì¼ ì¸ì¦",
					target : "ì¼ë°˜íšŒì›"
				})
			})
			.then(response => {
				if(!response.ok){
					return response.text().then(err => { throw new Error(err); });
				}
				return response.text();
			})
			.then(result => {
		        alert(result); 
		        // ì´í›„ UI ì²˜ë¦¬...
		    })
			.catch(error => {
		        alert("ì˜¤ë¥˜ ë°œìƒ: " + error.message);
		        return false;
		    });
		
		
		
		
		//ì¸ì¦ë²ˆí˜¸ ì…ë ¥ì¹¸& í™•ì¸ë²„íŠ¼ í‘œì‹œ
		document.getElementById('confirmNumberFrm').style.display='block';
		//displayë¥¼ none â†’ blockìœ¼ë¡œ ë°”ê¾¸ë©´ ê¸°ì¡´ flex ì†ì„±ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ì‹œ ì„¤ì •í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.
		document.getElementById('confirmNumberFrm').style.display='flex';
		//í™•ì¸ë²„íŠ¼ì€ 6ê°œ ìˆ«ìì¼ ê²½ìš°ì—ë§Œ ê°ì§€í•˜ì—¬ í™•ì¸ë²„íŠ¼ì„ í™œì„±í™” 
		document.getElementById('confirmNumber').addEventListener('input', function(e){
			let length = this.value.length;
			const btn = document.getElementById('confirmBtn');
			if(length == 6){
				btn.disabled = false;
			} else {
				btn.disabled = true;
			}
		})
		//ë³´ëƒˆìœ¼ë¯€ë¡œ ì¸ì¦ìš”ì²­ ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë¥¼ ì¬ì „ì†¡ìœ¼ë¡œ ë³€ê²½
		document.getElementById('codeBtn').textContent='ì¬ì „ì†¡'; 
		//íƒ€ì´ë¨¸ ì‹œì‘
		startTimer(300, $("#timer"));
		document.getElementById('remainTime').style.display='block'; //ë‚¨ì€ ì¸ì¦ì‹œê°„ í‘œì‹œ, ë§Œë£Œì‹œ ìˆ¨ê¹€ìœ¼ë¡œ í•´ë†¨ìœ¼ë¯€ë¡œ ì¬ì „ì†¡ì‹œ í•„ìš”
		document.getElementById('verification-error').style.display='none';  //ì¸ì¦ì‹œê°„ ë§Œë£Œ í‘œì‹œ ìˆ¨ê¹€, ì¬ì „ì†¡ì‹œ í•„ìš”
		//
		
	});

	//ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ í™•ì¸ë²„íŠ¼ì— ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ì°¸ì¡°ë§Œ ë„˜ê¸°ëŠ”ê±°ì— ì£¼ì˜, ..() x)
	document.getElementById('confirmBtn').addEventListener('click', checkConfirmNumber); 
	
}); //ready

//ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€ ë³€ìˆ˜
let isEmailVerified = false; //ì´ ì „ì—­ ë³€ìˆ˜ëŠ” ì´ë©”ì¼ ì¸ì¦í•¨ìˆ˜ì—ì„œ trueë¡œ ë³€í•¨
//í™•ì¸ë²„íŠ¼ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆì— ë“±ë¡ë  ì¸ì¦ë²ˆí˜¸í™•ì¸ í•¨ìˆ˜
function checkConfirmNumber(){
	let codeIsCorrect = false;
	
	let inputedCode = document.querySelector('#confirmNumber').value.trim();
	if(inputedCode == ""){
		alert("ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥ í›„ í™•ì¸ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
		return;
	}
	let email = document.querySelector('#email').value.trim();
	if(email == ""){
		alert('ì´ë©”ì¼ì„ ì…ë ¥í›„ ì‹œë„í•´ì£¼ì„¸ìš”.');
		return;	
	}
	//requestparam ë°©ì‹ì€ application/x-www-form-urlencoded í—¤ë”ë¡œ ì „ì†¡í•´ì•¼..  
	fetch('/signup/confirm-verification-code', {
		method : "POST",
		headers : {
			"Content-Type": "application/json"  
		},
		body : JSON.stringify({
			emailAddr : email,
			content : inputedCode
		})
	})
	//.then(res => {...}) ëŠ” ì¡°ê±´ë¬¸ì´ ì•„ë‹™ë‹ˆë‹¤.. ë¹„ë™ê¸° ì‘ì—…ì´ ì„±ê³µ(resolve) í–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½œë°± í•¨ìˆ˜ ë“±ë¡ì…ë‹ˆë‹¤.
	.then(response => { // responseëŠ” fetch()ê°€ ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µ(Response ê°ì²´)ì…ë‹ˆë‹¤. (HTTP ìƒíƒœ, ì‘ë‹µ í—¤ë”, ë³¸ë¬¸ ë“±ì„ í¬í•¨)
		//------------------------ì´ê±´ ì•ˆë¼--------------------------------------------------------
		// if(!response.ok){
		//	 throw new Error(response.text());
		// } else {
		//	 return reponse.text();
		// }
		// 1. response.text()ìœ¼ë¡œ ì‘ë‹µ ë³¸ë¬¸ì„ ë¨¼ì € ë¹„ë™ê¸°ë¡œ ì½ì€ ë’¤, ìƒíƒœì— ë”°ë¼ ì²˜ë¦¬í•´ì•¼ í•´
		// 2. throw new Error(response.text()) -> Promiseë¥¼ ê·¸ëŒ€ë¡œ ì—ëŸ¬ë¡œ ë˜ì§ â€” ì˜ë„í•œ ë©”ì‹œì§€ê°€ ì•„ë‹˜
		// 3. return response.text() ë‘ ë²ˆ í˜¸ì¶œ -> ìŠ¤íŠ¸ë¦¼ì€ í•œ ë²ˆë§Œ ì½ì„ ìˆ˜ ìˆì–´ì„œ ì˜¤ë¥˜ ë°œìƒ
		//--------------------------------------------------------------------------------------
		return response.text().then(msg => { // response.text() -> ì„œë²„ ì‘ë‹µ ë³¸ë¬¸ì„ ë¬¸ìì—´ë¡œ êº¼ë‚´ëŠ” ì‘ì—…. ì´ ì‘ì—…ì€ ë¹„ë™ê¸°(Promise ë°˜í™˜) â†’ ê·¸ë˜ì„œ .then(msg => {...})ë¡œ í›„ì† ì²˜ë¦¬
			if (!response.ok) {	//200~299ë©´ true			//ë³¸ë¬¸ì„ ë¬¸ìì—´ë¡œ êº¼ë‚´ì„œ msg ë³€ìˆ˜ì— ë‹´ì•„ì¤Œ.
				throw new Error(msg); //.catch()ë¡œ ì—ëŸ¬ê°€ ë„˜ì–´ê°
			}
			return msg;
		});
	})
	.then(result => {
  	console.log("ì¸ì¦ ì„±ê³µ ");
	  alert(result); //ì„±ê³µì‹œ ë©”ì‹œì§€ ë‚ ë¦¼ 
	  clearInterval(timerInterval);
		
		document.getElementById('remainTime').style.display='none'; //ë‚¨ì€ ì¸ì¦ì‹œê°„ ìˆ¨ê¸°ê³ ,
		document.getElementById('verification-success').style.display='block';  //ì„±ê³µ í…ìŠ¤íŠ¸ í‘œì‹œ
		document.getElementById('confirmBtn').disabled = true; //ë§ìœ¼ë‹ˆê¹Œ ì´ì œ í™•ì¸ë²„íŠ¼ ë§‰ì•„
		document.getElementById('codeBtn').disabled = true; //ë§ìœ¼ë‹ˆê¹Œ ì´ì œ ì¬ì „ì†¡ë²„íŠ¼ë„ ë§‰ì•„
		document.getElementById('email').readOnly = true; //ì´ë©”ì¼ ì…ë ¥ì°½ë„ ë§‰ì•„ 
		document.getElementById('confirmNumber').readOnly = true; //ë²ˆí˜¸ ì…ë ¥ì°½ë„ ë§‰ì•„
		document.getElementById('verification-error').style.display = 'none';
		document.getElementById('confirmNumberFrm').style.display='block';
		
		isEmailVerified = true; //ì´ë©”ì¼ ê²€ì¦ë³€ìˆ˜ true ë³€í™˜ 
	  //codeIsCorrect = true;
 	})
	.catch(error => { //ìš”ì²­ì´ ì‹¤íŒ¨í•˜ê±°ë‚˜, .then() ì¤‘ê°„ì— throw new Error(...)ê°€ ì‹¤í–‰ë˜ë©´ ì´ .catch()ë¡œ ì˜µë‹ˆë‹¤.
  	console.log("ì¸ì¦ ì‹¤íŒ¨ ");
  	alert(error.message); // alert(error.message)ì—ì„œ ì„œë²„ì—ì„œ ë„˜ê¸´ ë©”ì‹œì§€(e.getMessage())ê°€ ì¶œë ¥
  	document.getElementById('remainTime').style.display='none'; //ë‚¨ì€ ì¸ì¦ì‹œê°„ ìˆ¨ê¸°ê³ ,
		document.getElementById('verification-error').textContent='ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.'  //ì—ëŸ¬ í…ìŠ¤íŠ¸ ìˆ˜ì •í•˜ê³ ,
		document.getElementById('verification-error').style.display='block';  //ì—ëŸ¬ í…ìŠ¤íŠ¸ í‘œì‹œ
		
  });
	/** 
	JavaScriptì˜ ë¹„ë™ê¸° ì²˜ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ non-blocking, event-drivenì…ë‹ˆë‹¤.
	fetch()ëŠ” Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
	PromiseëŠ” ê²°ê³¼ê°€ ë‚˜ì¤‘ì— .then()ì´ë‚˜ .catch()ë¡œ ì½œë°±ì„ ë“±ë¡í•´ì„œ ì²˜ë¦¬ë¨
	JSëŠ” fetch() í˜¸ì¶œë§Œ í•´ë†“ê³ , ë°”ë¡œ ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ë²„ë¦¼
	ê·¸ë˜ì„œ ê²°ê³¼ê°€ ì˜¤ê¸°ë„ ì „ì— ë‹¤ìŒ ì½”ë“œê°€ ì‹¤í–‰ë¼, ë”°ë¼ì„œ fetch ì•„ë˜ì— ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ì“°ë©´ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šê¸°ë•Œë¬¸ì— ë„ˆê°€ ì›í•˜ëŠ” ê²°ê³¼ê°€ ì•ˆë‚˜ì™€. 
	
	promiseë€?
	"ë‚˜ì¤‘ì— ê²°ê³¼ ì¤„ê²Œ!"ë¼ê³  **ì•½ì†(Promise)**í•˜ëŠ” ê°ì²´
	
	ìˆœì„œ ì •ë¦¬ : 
	ì„œë¹„ìŠ¤ì—ì„œ throw â†’ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ catch â†’ ResponseEntity.badRequest().body(...) â†’ í”„ë¡ íŠ¸ì—ì„œ ë¹„ë™ê¸°(fetch, axios)ë¡œ ë°›ì•„ì„œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
	*/
}

// ëª¨ë‹¬ì°½ ê³¨ë¼ ì—´ê¸° 
function showTheModal(){
	// ì•½ê´€ ë²„íŠ¼ í´ë¦­ ì‹œ ì§ì ‘ ëª¨ë‹¬ ë‚´ìš© ë³€ê²½
	document.querySelectorAll('.term-btn').forEach(btn => {
		btn.addEventListener('click', function(e){
			// í´ë¦­ëœ ë²„íŠ¼ì˜ data-term ì†ì„± ê°€ì ¸ì˜¤ê¸°
			const selectedTerm = this.getAttribute('data-term');
			//console.log('ì„ íƒëœ ì•½ê´€:', selectedTerm);
			
			//ëª¨ë“  term fragmentë¥¼ ìˆ¨ê¸°ê¸° 			
			document.querySelectorAll('.term-fragment').forEach(div => {
				div.style.display = 'none';
			});
			
			//ì„ íƒí•˜ í•­ëª©ë§Œ í‘œì‹œ
			const target = document.getElementById(selectedTerm);
			if(target){
				target.style.display = 'block';
			}
			
		});
	});
} //showTheModal()


//------- íƒ€ì´ë¨¸ í•¨ìˆ˜ ---------
let timerInterval; // ğŸ”¸ ì „ì—­ìœ¼ë¡œ ì„ ì–¸í•´ì•¼ ê¸°ì¡´ íƒ€ì´ë¨¸ clear ê°€ëŠ¥

function startTimer(duration, display) {
    let timer = duration;
    let minutes, seconds;
    
    // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì •ë¦¬
    clearInterval(timerInterval);
    
    timerInterval = setInterval(function() {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);
        
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;
        
        display.text(minutes + ":" + seconds);
        
        //ì¸ì¦ì‹œê°„ ë§Œë£Œì‹œ
        if (--timer < 0) {
            clearInterval(timerInterval);
            document.getElementById('remainTime').style.display='none';
            //display.text("00:00");
            $("#verification-error").show();
            $("#verification-error").text("ì¸ì¦ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            
            document.getElementById('confirmBtn').disabled = true; //ë§Œë£Œëìœ¼ë‹ˆê¹Œ í™•ì¸ë²„íŠ¼ ë§‰ì•„

        }
    }, 1000);
}


//ì¹´ì¹´ì˜¤ ì£¼ì†Œì°¾ê¸°
function openKakaoMap(){
	new daum.Postcode({
	    oncomplete: function(data) {
	    	//console.log(data.zonecode);
	    	//console.log(data.roadAddress);
	    	document.getElementById("zipcode").value = data.zonecode;
	    	document.getElementById("roadAddress").value = data.roadAddress;
	    }
	}).open();
}

//ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ ajax
function ckEmailDupl(){
	document.getElementById("email").addEventListener("input",function(){
		const isEmailDupl ="ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
		let emailText = document.getElementById("email").value;
		
		$.ajax({
			url : "/ckEmailDupl",
			type : "GET",
			dataType: "json",
			//type : "POST",  									-> ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ @RequestBody EmailDTO dtoë¡œ ë°›ì•„ì•¼í•¨
			//contentType: "application/json", 	-> ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ @RequestBody EmailDTO dtoë¡œ ë°›ì•„ì•¼í•¨
			//data: JSON.stringfy(jsonObj), -> POST, PUT, PATCH ê°™ì€ ë³¸ë¬¸ì„ ì‚¬ìš©í•˜ëŠ” ìš”ì²­ì—ì„œ ì“°ê¸° 
			data : {
				email : emailText
			},
			success : function(reponse){
				if(reponse.duplicate){ //ì¤‘ë³µë¨
					document.getElementById("emailDuple").textContent=reponse.message;
					document.getElementById("emailDuple").style.display="block";
					document.getElementById("codeBtn").disabled=true;
				} else { //ì¤‘ë³µì•ˆë¨
					document.getElementById("emailDuple").textContent=reponse.message;
					document.getElementById("emailDuple").style.display="none";
					document.getElementById("codeBtn").disabled=false;
				}
			},
			error : function(xhr, status, error){
				console.error("ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ ì‹¤íŒ¨:");
				console.error("status: ", status);
				console.error("HTTP ìƒíƒœì½”ë“œ: ", xhr.status);
				console.error("ì—ëŸ¬ ë©”ì‹œì§€: ", error);
				console.error("ì‘ë‹µ ë³¸ë¬¸: ", xhr.responseText);

				alert("ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
			}
		});
		
	});
}

//ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì—¬ë¶€(í¸ì˜ì„±)
function isRightPassword(){
	document.getElementById('password').addEventListener('input', function(){
		let passwordInput = document.getElementById('password');
		const pwPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s#$*])[\S]{8,}$/;
		if(!pwPattern.test(passwordInput.value)){
			passwordInput.style.border = '2px solid #f4361e'; 
			document.querySelector('#passwordAlert').textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒ, ëŒ€/ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì(ê³µë°±, #, $, * ì œì™¸)ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.';
		} else {
			passwordInput.style.border = '2px solid #18C65D';
			document.querySelector('#passwordAlert').textContent = '';
		}
	});
}

//ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ì—¬ë¶€ 
function chkPasswordOneNTwo(){
	document.getElementById('password2').addEventListener('input', function(){
		let password = document.getElementById('password').value;
		let password2 = document.getElementById('password2').value;
		if(password != password2){
			document.getElementById('password2').style.border = '2px solid red';
			document.querySelector('#passwordAlert2').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
		} else {
			document.getElementById('password2').style.border = '2px solid #18C65D';
			document.querySelector('#passwordAlert2').textContent = '';
		}
		
	})
	
}

//ìˆ«ìê¸°ì…ì°½ì— í•˜ì´í”ˆ- ìë™ê¸°ì… í•´ì£¼ëŠ” í¸ì˜ì„± í•¨ìˆ˜
function isForYou(){
	document.getElementById("phone").addEventListener('input', function(){
		//ìˆ«ìë§Œ ë‚¨ê¸°ê³  ì œê±°
		let raw = this.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ ë‚¨ê¹€
		
		if(raw.length > 11) {
			raw = raw.slice(0, 11);
		}
		
		let formatted = '';
		
    if (raw.length >= 11) {
        formatted = raw.slice(0, 3) + '-' + raw.slice(3, 7) + '-' + raw.slice(7, 11);
      } else if (raw.length >= 8) {
        formatted = raw.slice(0, 3) + '-' + raw.slice(3, 7) + '-' + raw.slice(7);
      } else if (raw.length >= 4) {
        formatted = raw.slice(0, 3) + '-' + raw.slice(3);
      } else {
        formatted = raw;
      }
    this.value = formatted;
	});
	
	document.getElementById("birth").addEventListener('input', function(){
		// ìˆ«ìë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì œê±°
	  let raw = this.value.replace(/[^0-9]/g, '');
	  // ìµœëŒ€ 8ìë¦¬ê¹Œì§€ë§Œ ìë¥´ê¸°
	  if (raw.length > 8) raw = raw.slice(0, 8);
	  
	  let formatted = '';
	  
	  if (raw.length >= 5) {
	    formatted = raw.slice(0, 4) + '-' + raw.slice(4, 6);
	    if (raw.length >= 7) {
	      formatted += '-' + raw.slice(6, 8);
	    }
	  } else if (raw.length >= 1) {
	    formatted = raw;
	  }

	  this.value = formatted;
	  console.log(this.value);
	});
	
	
	
}
	
</script>
<body>
 <div class="header">
        <div class="header-content">
            <a th:href="@{/}"> <img th:src="@{/images/logo.png}" class="logo" style="width: 100px; height: 50px;"></a>
            <a th:href="@{/login}" class="login-link">ë¡œê·¸ì¸</a>
        </div>
    </div>

    <div class="container">
        <h1 class="form-title">ë¯¼ê¸°ì¸ë ¥ ê°œì¸íšŒì› ê°€ì…</h1>
        
        <form id="frm" th:action="@{/user/joinProcess}" method="post">
            <!-- 
            <div class="form-group">
              <label class="form-label">ì•„ì´ë””</label>
              <input type="text" name="username" class="form-input" placeholder="4~12ìì˜ ì˜ë¬¸ìì™€ ìˆ«ìì˜ ì¡°í•©" required >
            </div> 
            -->
            
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <div class="email-container">
	                <input type="email" id="email" name="email" class="form-input" placeholder="name@mingihire.co.kr">
	                <button type="button" id="codeBtn" class="btn btn-primary btn-sm" >ì¸ì¦ìš”ì²­</button>
                </div>
                <div id="confirmNumberFrm" class="email-container" style="margin-top: 5px; display: none; gap: 8px;">
	                <input type="text" id="confirmNumber" class="form-input" placeholder="ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." style="flex: 8;" >
	                <button type="button" id="confirmBtn" class="btn btn-success btn-sm" style="flex: 2;" disabled>í™•ì¸</button> <!-- js: ìˆ«ì 6ìë¦¬ì¼ê²½ìš°ì—ë§Œ í™œì„±í™” -->
                </div>
                <div id="remainTime" style="display: none">
	                <span style="color: red; font-size: 12px;" >ë‚¨ì€ì‹œê°„: </span>
	                <span id="timer" style="margin-top: 5px; color: red; font-size: 12px;"></span>
                </div>
                <!-- <div id="timer" style="margin-top: 5px; color: red; font-weight: bold;"></div> -->
                <div id="verification-error" style="margin-top: 5px; color: red; font-weight: bold;"></div>
                <div id="verification-success" style="margin-top: 5px; color: green; font-weight: bold; display: none; font-size: 12px;">ì¸ì¦ì— ì„±ê³µí•˜ì…¨ìŠµë‹ˆë‹¤.</div>
                <div id="emailDuple" style="margin-top: 5px; color: red; font-weight: bold;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" name="password" class="form-input" placeholder="8~16ì(ì˜ë¬¸ ëŒ€ì†Œë¬¸ì/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì, ëª¨ë‘ ì¡°í•©)" maxlength="16">
                <span id="passwordAlert" style="margin-top: 5px; color: red; font-size: 12px;"></span>
            </div>
            
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="password2" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" maxlength="16">
                <span id="passwordAlert2" style="margin-top: 5px; color: red; font-size: 12px;"></span>
            </div>

            <div class="form-group">
            	<label class="form-label">íœ´ëŒ€í°</label>
            	<input type="text" id="phone" name="phone" class="form-input" placeholder="ex) 010-1234-5678" maxlength="13">
            </div>

            <div class="form-group">
                <label class="form-label">ì´ë¦„</label>
                <input type="name" id="name" name="name" class="form-input" placeholder="ì´ë¦„ì…ë ¥" maxlength="20">
            </div>

            <div class="form-group">
                <label class="form-label">ìƒë…„ì›”ì¼</label>
                <input type="birth" id="birth" name="birth" class="form-input" placeholder="yyyy-MM-dd" maxlength="10">
            </div>
            
            <div class="form-group">
              <label class="form-label">ì„±ë³„</label>
              <div class="form_input">
              	<label class="form-check-label">
              		<input type="radio" class="form-check-input" name="gender" value="M">ë‚¨ì„±
              	</label>
              	<label class="form-check-label" style="margin-left: 15px;">
              		<input type="radio" class="form-check-input" name="gender" value="F">ì—¬ì„±
              	</label>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">ì£¼ì†Œ</label>
              <!-- ì£¼ì†Œì°¾ê¸°input í´ë¦­ì‹œ ë‹¤ìŒì£¼ì†ŒAPIí˜¸ì¶œ -->
              <div class="zipcode-box" >
               <input type="text" id="zipcode" name="zipcode" class="form-input addr" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
               <input type="button" id="openKakaoMap" class="btn btn-secondary" value="ìš°í¸ë²ˆí˜¸ ì°¾ê¸°" >
              </div>
              <input type="text" id="roadAddress" name="roadAddress" class="form-input addr" placeholder="ì£¼ì†Œ" style="margin-bottom: 10px;" readonly>
              <input type="text" id="detailAddress" name="detailAddress" class="form-input addr" placeholder="ìƒì„¸ì£¼ì†Œ">
            </div>

            <div class="form-group">
                <label class="form-label">ì•½ê´€</label>
                <div class="terms-section">
                    <div class="checkbox-group">
                        <div class="checkbox-item required-checkbox">
                            <input type="checkbox" class="checkbox-input" id="terms1">
                            <label for="terms1" class="checkbox-label"><strong>ì „ì²´ ë™ì˜</strong></label>
                        </div>
                        <div class="checkbox-item">
                       		<div class="terms-title">
                            <input type="checkbox" class="checkbox-input required" id="terms2">
                            <label for="terms2" class="checkbox-label"><strong>(í•„ìˆ˜) ê°œì¸íšŒì› ì•½ê´€ì— ë™ì˜</strong></label>
                       		</div>
                     			<div class="terms-detail-emoji">
                     				<a type="button" class="term-btn" data-term="userTerms" data-bs-toggle="modal" data-bs-target='#showTerm'> > </a>
                       		</div>
                        </div>
                        <div class="checkbox-item">
                        	<div class="terms-title">
                            <input type="checkbox" class="checkbox-input required" id="terms3">
                            <label for="terms3" class="checkbox-label"><strong>(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜</strong></label>
                          </div>
                          <div class="terms-detail-emoji">
                        		<a type="button" class="term-btn" data-term="privacyTerm" data-bs-toggle="modal" data-bs-target='#showTerm'> > </a>
                       		</div>
                        </div>
                        <div class="checkbox-item">
                          <div class="terms-title">  
                            <input type="checkbox" class="checkbox-input" id="terms4">
                            <label for="terms4" class="checkbox-label">(ì„ íƒ) ìœ„ì¹˜ê¸°ë°˜ì„œë¹„ìŠ¤ ì´ìš©ë™ì˜ì— ë™ì˜</label>
                          </div>
                          <div class="terms-detail-emoji">
                       			<a type="button" class="term-btn" data-term="locationTerm" data-bs-toggle="modal" data-bs-target='#showTerm'> > </a>
                       		</div> 
                        </div>
                        <div class="checkbox-item">
                          <div class="terms-title"> 
                            <input type="checkbox" class="checkbox-input" id="terms5">
                            <label for="terms5" class="checkbox-label">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ Â· ì´ë©”ì¼</label>
                          </div>
                          <div class="terms-detail-emoji">
                        		<a type="button" class="term-btn" data-term="marketingTerm_email" data-bs-toggle="modal" data-bs-target='#showTerm'> > </a>
                       		</div>  
                        </div>
                        <div class="checkbox-item">
 													<div class="terms-title">
                            <input type="checkbox" class="checkbox-input" id="terms6">
                            <label for="terms6" class="checkbox-label">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ Â· SMS/MMS</label>
                          </div>
                          <div class="terms-detail-emoji">
                        		<a type="button" class="term-btn" data-term="marketingTerm_sms" data-bs-toggle="modal" data-bs-target='#showTerm'> > </a>
                       		</div>  
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" id="submitBtn" class="submit-btn" >ë‹¤ìŒë‹¨ê³„</button>
        </form>
    </div>
    
    <!-- Vertically centered scrollable modal -->
    <div class="modal fade" id="showTerm" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			  <div class="modal-content">
			  
			  	<div class="modal-header">
			  		<h5 class="modal-title" id="myModalLabel">ì´ìš©ì•½ê´€</h5>
			  		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
			  	</div>
			  	
	      	<div class="modal-body" id="modalBodyContent">
	      		<!-- th:replaceëŠ” "fragmentë¥¼ ì°¾ëŠ” ì—­í• , ê²½ë¡œëŠ” fragmentsì¼ í•„ìš”ì—†ìŒ, ê·¸ë¦¬ê³  í•´ë‹¹ íƒœê·¸ë¥¼ fragmentë‚´ìš©ìœ¼ë¡œ êµì²´í•˜ë©´ì„œ style="dislplay:none"ì´ ë¬´ì‹œë˜ê³  ì‚¬ë¼ì§ˆìˆ˜ìˆìŒ-->
	      		<!-- ë˜í•œ replaceëŠ” fragmentë¡œ ëŒ€ì²´ë˜ë©´ì„œ divì˜ id, class, style, data-* ì†ì„± ëª¨ë‘ ì‚¬ë¼ì§.. ë”°ë¼ì„œ insertë¥¼ ì“°ì  -->
						<div id="userTerms" class="term-fragment" style="display: none;" th:insert="~{login/terms/userTerms :: userTerms}"></div>
						<div id="privacyTerm" class="term-fragment" style="display: none;" th:insert="~{login/terms/privacyPolicyAgreement :: privacyTerm}"></div>
						<div id="locationTerm" class="term-fragment" style="display: none;" th:insert="~{login/terms/locationTerms :: locationTerm}"></div>
						<div id="marketingTerm_email" class="term-fragment" style="display: none;" th:insert="~{login/terms/marketingTerms_email :: marketingTerm_email}"></div>
						<div id="marketingTerm_sms" class="term-fragment" style="display: none;" th:insert="~{login/terms/marketingTerms_sms :: marketingTerm_sms}"></div>
		      </div>
			  </div>
			</div>
    </div>

</body>
</html>